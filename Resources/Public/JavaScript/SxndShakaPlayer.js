(()=>{"use strict";var e,t={144:(e,t,s)=>{const i=jQuery;var n=s.n(i),r=s(480),o=s.n(r);class a{constructor(e,t={}){this._element=e,this._$element=n()(e),this._isAnimating=!1,this._state={show:!1,...t},this._closeButton=this._element.querySelector(".modal-close"),this._closeButton&&this._closeButton.addEventListener("click",this.close.bind(this))}get isOpen(){return this._state.show}open(e=!0){this._isAnimating||this.setState({show:e})}close(){this.open(!1)}toggle(){this.open(!this._state.show)}setState(e={}){const t=Object.assign({},this._state,e);this.render(t),this._state=t}render(e){const{show:t}=e;if(t!=this._state.show){this._isAnimating=!0;const e=t?"show":"hide";this._$element[e]({duration:"fast",complete:()=>{this._isAnimating=!1}})}}}class c extends a{constructor(e){super(e,{timecode:null}),this._urlInput=this._element.querySelector(".url-input")}setTimecode(e){return this.setState({timecode:e}),this}render(e){super.render(e);const{show:t,timecode:s}=e;if(null!==s&&s!==this._state.timecode){const t=new URL(window.location);t.searchParams.set("timecode",e.timecode),this._urlInput.value=t.toString()}t&&t!==this._state.show&&this._urlInput.select()}}let l=0;class h{constructor(e){this._chapters=e.map((e=>({id:l++,title:e.title,timecode:parseInt(e.timecode,10)}))),this._chapters.sort(((e,t)=>e.timecode-t.timecode)),this._idToIndex=new Map;for(let e=0;e<this._chapters.length;e++){const t=this._chapters[e];this._idToIndex.set(t.id,e)}}at(e){return this._chapters[e]}indexOf(e){return this._idToIndex.get(e.id)}advance(e,t=1){let s=this.indexOf(e);if(void 0!==s)return this._chapters[s+t]}timeToChapter(e){for(let t=this._chapters.length-1;t>=0;t--){const s=this._chapters[t];if(e>=s.timecode)return s}}[Symbol.iterator](){return this._chapters.values()}}class d extends o().ui.Element{static KEY="capture";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="Screenshot",this.button_.textContent="photo_camera",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.showScreenshot()}))}}function u(e,t){return(t?[e/3600,e/60%60,e%60]:[e/60,e%60]).map(((e,t)=>Math.floor(e).toString().padStart(0==t?0:2,"0"))).join(":")}d.Factory=class{create(e,t){return new d(e,t)}},o().ui.Controls.registerElement(d.KEY,new d.Factory);class m extends o().ui.Element{static KEY="time_and_duration_frame";constructor(e,t){super(e,t),this.currentTime_=document.createElement("button"),this.currentTime_.classList.add("shaka-current-time"),this.parent.appendChild(this.currentTime_),this.state={},this.render({totalSeconds:0,activeMode:0}),this.eventManager.listen(this.currentTime_,"click",(()=>{this.render({activeMode:(this.state.activeMode+1)%3})})),this.eventManager.listen(this.controls,"timeandseekrangeupdated",(()=>{this.render({totalSeconds:this.controls.getDisplayTime()})}))}render(e){const t=Object.assign({},this.state,e),{totalSeconds:s,activeMode:i}=t;if(s!==this.state.totalSeconds||i!==this.state.activeMode){const e=this.controls.elSxndPlayer,t=e.video.duration>=3600;let n,r;switch(i){default:n=u(s,t),e.vifa&&(n+=":"+("0"+e.vifa.get()%e.fps).slice(-2)),e.video.duration&&(n+=" / "+u(e.video.duration,t)),r="Aktuelle Laufzeit / Gesamtlaufzeit";break;case 1:n=u(e.video.duration-s,t),r="Restlaufzeit";break;case 2:n=`${e.vifa.get()}`,r="Frame-Nummer"}let o=e.chapters.timeToChapter(s);o&&(n+=` – ${o.title}`),this.currentTime_.textContent=n,this.currentTime_.title=r}this.state=t}}m.Factory=class{create(e,t){return new m(e,t)}},o().ui.Controls.registerElement(m.KEY,new m.Factory);class p extends o().ui.Element{static KEY="replay_10";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="10 Sekunden zurück",this.button_.textContent="replay_10",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.skipSeconds(-10)}))}}p.Factory=class{create(e,t){return new p(e,t)}},o().ui.Controls.registerElement(p.KEY,new p.Factory);class v extends o().ui.Element{static KEY="skip_previous";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="Einzelbild zurück",this.button_.textContent="skip_previous",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.vifa.seekBackward(1)}))}}v.Factory=class{create(e,t){return new v(e,t)}},o().ui.Controls.registerElement(v.KEY,new v.Factory);class f extends o().ui.Element{static KEY="skip_next";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="Einzelbild weiter",this.button_.textContent="skip_next",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.vifa.seekForward(1)}))}}f.Factory=class{create(e,t){return new f(e,t)}},o().ui.Controls.registerElement(f.KEY,new f.Factory);class _ extends o().ui.Element{static KEY="forward_10";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="10 Sekunden vor",this.button_.textContent="forward_10",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.skipSeconds(10)}))}}_.Factory=class{create(e,t){return new _(e,t)}},o().ui.Controls.registerElement(_.KEY,new _.Factory);class y extends o().ui.Element{static KEY="bookmark";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="Bookmark",this.button_.textContent="bookmark_border",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>this.controls.elSxndPlayer.showBookmarkUrl()))}}let b,k;y.Factory=class{create(e,t){return new y(e,t)}},o().ui.Controls.registerElement(y.KEY,new y.Factory);class g{constructor(e){this.video=e.video,this.manifestUri=e.manifestUri,this.initialTimecode=e.timecode}async initialize(){this.chapters=new h(window.VIDEO_CHAPTERS),this.fps=25;const e=this.video.ui;this.controls=e.getControls(),this.player=new(o().Player)(this.video),this.controls.elSxndPlayer=this;const t={addSeekBar:!0,controlPanelElements:["play_pause","chapters_menu",m.KEY,"spacer","volume","mute",p.KEY,v.KEY,f.KEY,_.KEY,d.KEY,y.KEY,"fullscreen","overflow_menu"],overflowMenuButtons:["language","playback_rate","loop","quality","picture_in_picture","captions"],addBigPlayButton:!0,seekBarColors:{base:"rgba(255, 255, 255, 0.3)",buffered:"rgba(255, 255, 255, 0.54)",played:"rgb(255, 255, 255)",adBreaks:"rgb(255, 204, 0)"}};e.configure(t),this.renderChapterMarkers(),this.player.addEventListener("error",this.onPlayerErrorEvent.bind(this)),this.controls.addEventListener("error",this.onUiErrorEvent.bind(this)),this.vifa=VideoFrame({id:this.video.id,frameRate:this.fps,callback:function(e){console.log("callback response: "+e)}});try{console.log("The video has now been loaded!"),await this.player.load(this.manifestUri,this.initialTimecode)}catch(e){onError(e)}}renderChapterMarkers(){const e=document.querySelector(".shaka-seek-bar-container");for(const t of this.chapters){const s=t.timecode/this.video.duration;if(!(0<=s&&s<1))continue;const i=document.createElement("span");i.className="sxnd-chapter-marker",i.style.position="absolute",i.style.left=t.timecode/this.video.duration*100+"%",i.title=t.title,i.addEventListener("click",(()=>{this.play(),this.seekTo(t)}));const n=document.createElement("span");i.append(n),e.append(i)}}onPlayerErrorEvent(e){this.onPlayerError(e.detail)}onUiErrorEvent(e){this.onPlayerError(e.detail)}onPlayerError(e){console.error("Error code",e.code,"object",e)}get currentTime(){return this.video.currentTime}get displayTime(){return this.controls.getDisplayTime()}getCurrentChapter(){return this.timeToChapter(this.currentTime)}timeToChapter(e){return this.chapters.timeToChapter(e)}play(){this.video.play()}pause(){this.video.pause()}seekTo(e){null!=e&&("number"==typeof e?this.video.currentTime=e:"number"==typeof e.timecode&&(this.video.currentTime=e.timecode))}skipSeconds(e){this.video.currentTime+=e}prevChapter(){this.seekTo(this.timeToChapter(this.currentTime-5)??0)}nextChapter(){let e=this.getCurrentChapter();e&&this.seekTo(this.chapters.advance(e,1))}showBookmarkUrl(){this.pause(),b.bookmark.setTimecode(this.displayTime).open()}showScreenshot(){this.pause(),function(e){const t=document.createElement("template");t.innerHTML='<div id="screenshot-overlay"><span class="close-screenshot-modal icon-close"></span><canvas></canvas></div>';const s=t.content.firstElementChild;document.body.append(s);const i=s.querySelector("canvas");s.querySelector(".close-screenshot-modal").addEventListener("click",(()=>{s.remove()})),function(e,t,s){const[i,n]=e instanceof HTMLCanvasElement?[e,e.getContext("2d")]:[e.canvas,e],r=s.screenshotFields.map((e=>s.metadata[e])).filter((e=>"string"==typeof e)).join(" / ");i.width=t.videoWidth,i.height=t.videoHeight,n.drawImage(t,0,0,i.width,i.height);const o=i.height/1080,a=10*o;n.font=`${Math.floor(25*o)}px Arial`,n.textAlign="end",n.fillStyle="#FFFFFF",n.shadowBlur=5,n.shadowColor="black",n.fillText(r,i.width-a,i.height-a),i.style.width="80%",i.style.height="auto"}(i,e,function(e){var t={metadata:{},screenshotFields:e.getAttribute("data-screenshotfields").split(",")};for(const s of e.children)s.value&&(t.metadata[s.id]=s.value);return t}(document.getElementById("metadata")))}(this.video)}}document.addEventListener("shaka-ui-loaded",(()=>{const e=new URL(window.location).searchParams.get("timecode");k=new g({video:document.getElementById("video"),manifestUri:document.getElementsByClassName("mime-type-video")[0].getAttribute("data-url")+".mpd",timecode:e?parseFloat(e):void 0}),k.initialize(),n()("a[data-timecode]").on("click",(function(){const e=n()(this).data("timecode");k.play(),k.seekTo(e)})),b=function(e){const t=Object.assign({},e),s=Object.values(e);return t.hasOpen=()=>s.some((e=>e.isOpen)),t.closeNext=()=>{for(const e of s)if(e.isOpen){e.close();break}},t}({help:new a(document.querySelector(".dfgplayer-help")),bookmark:new c(document.querySelector(".bookmark-modal"))}),document.addEventListener("keydown",(e=>{"F1"==e.key?(e.preventDefault(),b.help.toggle()):"Escape"==e.key&&(e.preventDefault(),b.closeNext()),b.hasOpen()||("f"==e.key?(e.preventDefault(),k.controls.toggleFullScreen()):" "==e.key?(e.preventDefault(),k.video.paused?k.video.play():k.video.pause()):"ArrowUp"==e.key?(e.preventDefault(),k.video.volume=Math.min(1,k.video.volume+.05)):"ArrowDown"==e.key?(e.preventDefault(),k.video.volume=Math.max(0,k.video.volume-.05)):"ArrowLeft"==e.key?(e.preventDefault(),e.ctrlKey||e.metaKey?k.prevChapter():e.shiftKey?k.vifa.seekBackward(1):k.skipSeconds(-10)):"ArrowRight"==e.key?(e.preventDefault(),e.ctrlKey||e.metaKey?k.nextChapter():e.shiftKey?k.vifa.seekForward(1):k.skipSeconds(10)):"m"==e.key?(e.preventDefault(),k.video.muted=!k.video.muted):"."==e.key?(e.preventDefault(),k.vifa.seekForward(1)):","==e.key?(e.preventDefault(),k.vifa.seekBackward(1)):"b"==e.key?(e.preventDefault(),k.showBookmarkUrl()):"s"==e.key&&(e.preventDefault(),k.showScreenshot()))}))})),document.addEventListener("shaka-ui-load-failed",(e=>{console.error("Unable to load the UI library!")}))}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var r=s[e]={exports:{}};return t[e](r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,s,n,r)=>{if(!s){var o=1/0;for(h=0;h<e.length;h++){for(var[s,n,r]=e[h],a=!0,c=0;c<s.length;c++)(!1&r||o>=r)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(a=!1,r<o&&(o=r));if(a){e.splice(h--,1);var l=n();void 0!==l&&(t=l)}}return t}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[s,n,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={86:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,r,[o,a,c]=s,l=0;if(o.some((t=>0!==e[t]))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(c)var h=c(i)}for(t&&t(s);l<o.length;l++)r=o[l],i.o(e,r)&&e[r]&&e[r][0](),e[o[l]]=0;return i.O(h)},s=self.webpackChunkslub_web_sachsendigital=self.webpackChunkslub_web_sachsendigital||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=i.O(void 0,[73],(()=>i(144)));n=i.O(n)})();
//# sourceMappingURL=SxndShakaPlayer.js.map