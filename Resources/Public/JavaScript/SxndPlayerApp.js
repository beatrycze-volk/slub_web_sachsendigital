/*! For license information please see SxndPlayerApp.js.LICENSE.txt */
(()=>{"use strict";var e,t={465:(e,t,s)=>{function i(e,[t,s]){return e<t?t:e>s?s:e}async function n(e){const t=h("img");return t.decoding="async",t.src=e,await t.decode(),t}function r(e,t){"string"==typeof e?h("a",{href:e,download:t}).click():a(e,(e=>{r(e,t)}))}function a(e,t){const s=URL.createObjectURL(e);let i;try{i=t(s)}catch(e){throw URL.revokeObjectURL(s),e}if(i instanceof Promise){const e=i;return new Promise(((t,i)=>{e.then((e=>{URL.revokeObjectURL(s),t(e)})).catch((e=>{URL.revokeObjectURL(s),i(e)}))}))}return URL.revokeObjectURL(s),i}function o(e){return e.preventDefault(),!1}function h(e,t={},s=[]){const i=document.createElement(e);for(const[e,s]of Object.entries(t))"$"===e[0]?i.addEventListener(e.substring(1),s):i[e]=s;for(const e of s)"string"==typeof e?i.append(document.createTextNode(e)):e instanceof HTMLElement&&i.append(e);return i}function l(e,t,s){s?e.classList.add(t):e.classList.remove(t)}const c={None:0,CtrlMeta:1,Shift:2,Alt:4};class d{constructor(e){this.chapters=e.slice(),this.chapters.sort(((e,t)=>e.timecode-t.timecode)),this.chapterToIndex=new Map;for(const[e,t]of this.chapters.entries())this.chapterToIndex.set(t,e)}at(e){return this.chapters[e]}indexOf(e){return this.chapterToIndex.get(e)}advance(e,t=1){const s=this.indexOf(e);if(void 0!==s)return this.chapters[s+t]}timeToChapter(e){for(const t of this.reversed())if(e>=t.timecode)return t}[Symbol.iterator](){return this.chapters.values()}*reversed(){for(let e=this.chapters.length-1;e>=0;e--)yield this.chapters[e]}}var u=s(480),p=s.n(u);class m extends p().ui.Element{static register(e,t={}){const s=e.mkid();return p().ui.Controls.registerElement(s,{create:(e,s)=>new m(e,s,t)}),s}constructor(e,t,s={}){super(e,t);const i=h("button",{className:`material-icons-round ${s.className??""}`},[s.material_icon]);e.appendChild(i),this.sxnd={config:s,button:i},this.eventManager&&s.onClick&&this.eventManager.listen(i,"click",s.onClick),this.updateStrings()}updateStrings(){this.sxnd.button.title=this.sxnd.config.title??""}}class g{constructor(){this.tasks={}}get(e){const t=this.tasks[e]??=this.createTask(e);return this.resumeTask(t)}getCached(e){const t=this.tasks[e]?.state;return 4===t?.type?t.image:null}abortPending(){for(const[e,t]of Object.entries(this.tasks))this.stopTask(t)}createTask(e){return{state:{type:0,url:e},promise:null,stopNext:!1}}stopTask(e){e.stopNext=!0}resumeTask(e){return e.stopNext=!1,null===e.promise&&(e.promise=new Promise((async(t,s)=>{try{for(;;){if(4===e.state.type){t(e.state.image);break}if(e.stopNext){e.promise=null;break}await this.progressTask(e)}}catch(e){s(e)}}))),e.promise}async progressTask(e){switch(e.state.type){case 0:{const t=new AbortController,s=e.state.url,i=fetch(s,{signal:t.signal});e.state={type:1,abortController:t,responsePromise:i};break}case 1:{const t=await e.state.responsePromise;if(!t.ok)throw t;e.state={type:2,imageBlob:await t.blob()};break}case 2:e.state={type:3,imagePromise:(t=e.state.imageBlob,a(t,n))};break;case 3:{const t=await e.state.imagePromise;e.state={type:4,image:t};break}}var t}}function v(e,t,s=null){const i=t?[e/3600,e/60%60,e%60]:[e/60,e%60];return s&&i.push(Math.floor(e%1*s)),i.map(((e,t)=>Math.floor(e).toString().padStart(0==t?0:2,"0"))).join(":")}class f{constructor(e){this.seekBar=e.seekBar,this.player=e.player,this.network=e.network,this.interaction=e.interaction,this.fps=null,this.chapters=null,this.imageTracks=[],this.lastRendered=null,this.isChanging=!1,this.showContainer=!1,this.current=null,this.renderAnimationFrame=null,this.handlers={onWindowBlur:this.onWindowBlur.bind(this),onWindowResize:this.onWindowResize.bind(this),onPointerMove:this.onPointerMove.bind(this),onPointerDown:this.onPointerDown.bind(this),onPointerUpOrCancel:this.onPointerUpOrCancel.bind(this)},this.$container=h("div",{className:"sxnd-thumbnail-preview noselect"},[h("div",{className:"content-box"},[this.$display=h("div",{className:"display"},[this.$img=h("img"),this.$thumbTimecode=h("div",{className:"thumb-timecode"})]),this.$info=h("span",{className:"info"},[this.$chapterText=h("span",{className:"chapter-text"}),this.$timecodeText=h("span",{className:"timecode-text"})])])]),this.$seekMarker=h("div",{className:"seek-marker"}),this.seekBar.append(this.$seekMarker,this.$container),this.ensureDisplaySize(160,90),window.addEventListener("blur",this.handlers.onWindowBlur),window.addEventListener("resize",this.handlers.onWindowResize),document.addEventListener("pointermove",this.handlers.onPointerMove),document.addEventListener("pointerdown",this.handlers.onPointerDown),document.addEventListener("pointerup",this.handlers.onPointerUpOrCancel),document.addEventListener("pointercancel",this.handlers.onPointerUpOrCancel)}release(){window.removeEventListener("blur",this.handlers.onWindowBlur),window.removeEventListener("resize",this.handlers.onWindowResize),document.removeEventListener("pointermove",this.handlers.onPointerMove),document.removeEventListener("pointerdown",this.handlers.onPointerDown),document.removeEventListener("pointerup",this.handlers.onPointerUpOrCancel),document.removeEventListener("pointercancel",this.handlers.onPointerUpOrCancel)}setFps(e){this.fps=e,this.currentRenderBest()}setChapters(e){this.chapters=e,this.currentRenderBest()}setImageTracks(e){this.imageTracks=e.slice(),this.imageTracks.sort(((e,t)=>t.bandwidth-e.bandwidth)),this.currentRenderBest()}onWindowBlur(){this.cancelPreview()}onWindowResize(){this.cancelPreview()}async onPointerMove(e){const t=this.mouseEventToPosition(e);if(void 0===t)return this.setIsVisible(!1);"touch"===e.pointerType&&this.beginChange();const s=this.getThumbTracks().map((async e=>{const s=await this.player.getThumbnails(e.id,t.seconds);return null===s?null:{...s,track:e}})),i=(await Promise.all(s)).filter((e=>null!==e));this.current={seekPosition:t,thumbs:i},this.isChanging&&0!=(1&e.buttons)&&this.interaction?.onChange?.(t),this.currentRenderBest()}onPointerDown(e){if(0!=(1&e.buttons)){const t=this.mouseEventToPosition(e,"mouse"===e.pointerType);void 0!==t&&(this.beginChange(),this.interaction?.onChange?.(t))}}onPointerUpOrCancel(e){this.endChange(),"mouse"===e.pointerType&&void 0!==this.mouseEventToPosition(e)||this.setIsVisible(!1)}mouseEventToPosition(e,t=!0){const s=this.saneVideoDuration();if(void 0===s)return;if(null!==document.querySelector("input[type=button]:hover, button:hover"))return;const n=this.seekBar.getBoundingClientRect();if(!this.isChanging)if(this.showContainer&&t){const{left:t,right:s,bottom:i}=n;if(!(t<=e.clientX&&e.clientX<=s&&e.clientY<=i))return;const{top:r}=this.$container.getBoundingClientRect();if(!(r<=e.clientY))return}else if(!(e.target instanceof Node&&this.seekBar.contains(e.target)))return;const r=s/n.width;let a=e.clientX-n.left,o=i(a*r,[0,s]);const h=this.chapters?.timeToChapter(o);let l=!1;if(h&&!this.isChanging){const e=(o-h.timecode)/r;-2<=e&&e<6&&(o=h.timecode,a=o/r,l=!0)}return{absolute:a,seconds:o,chapter:h,onChapterMarker:l}}ensureDisplaySize(e,t){const s=Math.floor(160/e*t);this.$display.clientHeight!==s&&(this.$display.style.height=`${s}px`)}currentRenderBest(){null===this.renderAnimationFrame&&(this.renderAnimationFrame=window.requestAnimationFrame((()=>{this.renderAnimationFrame=null;const e=this.current;if(null!==e){this.setIsVisible(!0,e.thumbs.length>0,!1),this.renderSeekPosition(e.seekPosition);for(const t of e.thumbs){const s=t.uris[0];if(void 0===s)continue;const i=this.network.getCached(s);if(null!==i){this.renderImageAndShow(s,t,i,e.seekPosition);break}this.network.get(s).then((()=>{this.currentRenderBest()}))}}})))}renderImageAndShow(e,t,s,i){0<=t.width&&t.width<=1&&0<=t.height&&t.height<=1&&(t.positionX*=s.width,t.width*=s.width,t.positionY*=s.height,t.height*=s.height),this.ensureDisplaySize(t.width,t.height),this.renderImage(e,t,s),this.setIsVisible(!0),this.positionContainer(i)}renderImage(e,t,s,i=!1){if(i||null===this.lastRendered||t.startTime!==this.lastRendered.thumb.startTime||t.track.bandwidth!==this.lastRendered.thumb.track.bandwidth){const{positionX:i,positionY:n,width:r,height:a}=t,o=160/r;this.$img.replaceWith(s),this.$img=s,this.$img.style.transform=[`scale(${o})`,`translateX(-${i}px)`,`translateY(-${n}px)`].join(" "),this.$img.style.transformOrigin="left top",this.renderThumbTimecode(t),this.lastRendered={uri:e,thumb:t,tilesetImage:s}}}renderThumbTimecode(e){const t=this.saneVideoDuration(),s=void 0===t||t>=3600,i=v(e.startTime+e.duration/2-1e-5,s,this.fps);this.$thumbTimecode.innerText=i}positionContainer(e){const t=i(e.absolute-this.$container.offsetWidth/2,[0,this.seekBar.clientWidth-this.$container.offsetWidth]);this.$container.style.left=`${t}px`}renderSeekPosition(e){const t=this.saneVideoDuration();if(void 0===t)return void this.setIsVisible(!1);this.$seekMarker.style.left=`${e.absolute}px`,e.onChapterMarker?this.$info.classList.add("on-chapter-marker"):this.$info.classList.remove("on-chapter-marker");const s=e.chapter?.title??"";this.$chapterText.innerText=s,l(this.$chapterText,"displayed",""!==s),this.$timecodeText.innerText=v(e.seconds,t>=3600,this.fps),this.positionContainer(e)}cancelPreview(){this.setIsVisible(!1),this.endChange()}beginChange(){this.isChanging||(this.interaction?.onChangeStart?.(),document.body.classList.add("seek-or-scrub"),this.isChanging=!0)}endChange(){this.isChanging&&(this.interaction?.onChangeEnd?.(),document.body.classList.remove("seek-or-scrub"),this.isChanging=!1)}get isVisible(){return this.showContainer}setIsVisible(e,t=e,s=t){e||(this.current=null),this.showContainer=e,l(this.$container,"sxnd-visible",e),l(this.$seekMarker,"sxnd-visible",e),l(this.$display,"is-open",t),l(this.$img,"sxnd-visible",s),l(this.$thumbTimecode,"sxnd-visible",s),function(e){e.draggable=!1,e.ondragstart=o}(this.$img)}getThumbTracks(){if(!this.showThumbnailImage())return[];const e=.01*this.player.getStats().estimatedBandwidth;for(let t=0;t<this.imageTracks.length;t++){const s=this.imageTracks[t];if(s.bandwidth<e){const e=s;return t===this.imageTracks.length-1?[e]:[e,this.imageTracks[this.imageTracks.length-1]]}}return[]}showThumbnailImage(){return 300<=.4*(this.player.getMediaElement()?.clientHeight??0)}saneVideoDuration(){const e=this.player.getMediaElement()?.duration;return void 0!==e&&e>0?e:void 0}}class y{constructor(e){if(this.player=e,this.manifest=e.getManifest(),this.groupKeys=[],this.groups=[],this.keyToGroup={},null!==this.manifest){for(const e of this.manifest.variants)this.addVariant(e);for(const e of this.manifest.imageStreams)e.width=1,e.height=1}else console.warn("Manifest not available")}static splitRepresentationId(e){const t=(e??"").split("#");return{id:t[0]??null,group:t[1]??"Standard"}}addVariant(e){const t=e.video;if(t){const s=y.splitRepresentationId(t.originalId).group,i=this.getGroupOrCreate(s);i.variants.push(e);for(const e of t.roles)i.roles.add(e);t.primary&&(i.hasPrimary=!0)}}get numGroups(){return this.groupKeys.length}getGroupOrCreate(e){let t=this.keyToGroup[e];return t||(t=this.keyToGroup[e]={key:e,variants:[],roles:new Set,hasPrimary:!1},this.groupKeys.push(e),this.groups.push(t)),t}findActiveTrack(){return this.player.getVariantTracks().find((e=>e.active))}findImageTracks(){const e=this.findActiveGroup()?.key;return this.player.getImageTracks().filter((t=>y.splitRepresentationId(t.originalImageId).group===e))}findActiveGroup(){const e=this.findActiveTrack();if(e){const t=y.splitRepresentationId(e.originalVideoId).group;return this.keyToGroup[t]}}selectGroup(e){if(this.manifest){if(this.manifest.variants!==e.variants){const t=this.findActiveTrack();this.manifest.variants=e.variants,this.player.selectAudioLanguage(t?.language??"und")}}else console.warn("Cannot select group: Manifest not available")}trySelectGroup(e){return!!e&&(this.selectGroup(e),!0)}selectGroupByKey(e){return this.trySelectGroup(this.keyToGroup[e])}selectGroupByIndex(e){return this.trySelectGroup(this.groups[e])}selectGroupByRole(e){return this.trySelectGroup(this.groups.find((t=>t.roles.has(e))))}selectGroupWithPrimary(){return this.trySelectGroup(this.groups.find((e=>e.hasPrimary)))}*[Symbol.iterator](){for(const e in this.keyToGroup)yield this.keyToGroup[e]}}class k extends p().ui.Element{static register(){p().ui.Controls.registerSeekBar({create:(e,t)=>new k(e,t)})}constructor(e,t){super(e,t),this.$container=h("div",{className:"sxnd-seek-bar"},[this.$range=h("div",{className:"range"})]),e.prepend(this.$container),this.sxnd={chapters:null,hasRenderedChapters:!1,variantGroups:null,value:0,uiConfig:t.getConfig(),wasPlaying:!1,seekTimer:null,thumbnailPreview:null,lastGradientStr:""},this.sxnd.seekTimer=new(p().util.Timer)((()=>{null!==this.video&&(this.video.currentTime=this.getValue())})),null!==this.player&&(this.sxnd.thumbnailPreview=new f({seekBar:this.$container,player:this.player,network:new g,interaction:{onChangeStart:()=>{this.controls?.setSeeking(!0),null!==this.video&&(this.sxnd.wasPlaying=!this.video.paused,this.video.pause())},onChange:e=>{this.sxnd.value=e.seconds,this.update(),this.sxnd.seekTimer?.tickAfter(.125)},onChangeEnd:()=>{this.sxnd.seekTimer?.tickNow(),this.controls?.setSeeking(!1),this.sxnd.wasPlaying&&this.video?.play()}}})),this.eventManager&&(this.eventManager.listen(this.player,"loaded",(()=>{this.update()})),this.eventManager.listen(this.player,"variantchanged",(()=>{this.updatePreviewImageTracks()})),this.eventManager.listen(this.controls,"sxnd-variant-groups",(e=>{const t=e.detail;this.sxnd.variantGroups=t.variantGroups,this.updatePreviewImageTracks()})),this.eventManager.listen(this.controls,"sxnd-chapters",(e=>{const t=e.detail;this.sxnd.chapters=t.chapters,this.sxnd.hasRenderedChapters=!1,this.sxnd.thumbnailPreview?.setChapters(t.chapters),this.update()})),this.eventManager.listen(this.controls,"sxnd-fps",(e=>{const t=e.detail;this.sxnd.thumbnailPreview?.setFps(t.fps)})),this.controls?.dispatchEvent(new CustomEvent("sxnd-seek-bar",{detail:{seekBar:this}})))}release(){null!==this.sxnd.seekTimer&&(this.sxnd.seekTimer.stop(),this.sxnd.seekTimer=null),null!==this.sxnd.thumbnailPreview&&(this.sxnd.thumbnailPreview.release(),this.sxnd.thumbnailPreview=null),super.release()}isThumbnailPreviewOpen(){return this.sxnd.thumbnailPreview?.isVisible??!1}hideThumbnailPreview(){this.sxnd.thumbnailPreview?.setIsVisible(!1)}renderChapterMarkers(e,t){this.$range.querySelectorAll(".sxnd-chapter-marker").forEach((e=>{e.remove()}));for(const s of e){const e=s.timecode/t;if(!(0<=e&&e<1))continue;const i=document.createElement("span");i.className="sxnd-chapter-marker",i.style.position="absolute",i.style.left=100*e+"%",this.$range.append(i)}}updatePreviewImageTracks(){if(null===this.sxnd.thumbnailPreview)return void console.warn("FlatSeekBar: Missing player or thumbnail preview");if(null===this.sxnd.variantGroups)return;const e=this.sxnd.variantGroups.findImageTracks();this.sxnd.thumbnailPreview.setImageTracks(e)}getValue(){return this.sxnd.value}isShowing(){return!0}setValue(e){this.controls?.isSeeking()||(this.sxnd.value=e)}makeColor(e,t){return`${e} ${100*t}%`}update(){if(null===this.video)return void console.warn("FlatSeekBar: Missing video");const e=this.video.duration;if(!(e>0))return;null===this.sxnd.chapters||this.sxnd.hasRenderedChapters||(this.renderChapterMarkers(this.sxnd.chapters,e),this.sxnd.hasRenderedChapters=!0);const t=this.sxnd.uiConfig.seekBarColors,s=this.getValue(),i=this.video.buffered.length,n=i?this.video.buffered.start(0):0,r=i?this.video.buffered.end(i-1):0,a={start:0,end:e},o=a.end-a.start,h=Math.max(n,a.start),l=Math.min(r,a.end),c=Math.min(Math.max(s,a.start),a.end),d=(h-a.start)/o||0,u=(l-a.start)/o||0,p=(c-a.start)/o||0,m=this.sxnd.uiConfig.showUnbufferedStart?t.base:t.played,g="linear-gradient("+["to right",this.makeColor(m,d),this.makeColor(t.played,d),this.makeColor(t.played,p),this.makeColor(t.buffered,p),this.makeColor(t.buffered,u),this.makeColor(t.base,u)].join(",")+")";g!==this.sxnd.lastGradientStr&&(this.sxnd.lastGradientStr=g,this.$range.style.background=g)}}p().ui.SettingsMenu;var b=function(e){if(this===window)return new b(e);this.obj=e||{},this.frameRate=this.obj.frameRate||24,this.video=document.getElementById(this.obj.id)||document.getElementsByTagName("video")[0]};b.prototype={get:function(){return Math.floor(this.video.currentTime.toFixed(5)*this.frameRate)},listen:function(e,t){var s=this;e?this.interval=setInterval((function(){if(!s.video.paused&&!s.video.ended){var t="SMPTE"===e?s.toSMPTE():"time"===e?s.toTime():s.get();return s.obj.callback&&s.obj.callback(t,e),t}}),t||1e3/s.frameRate/2):console.log("VideoFrame: Error - The listen method requires the format parameter.")},stopListen:function(){clearInterval(this.interval)},fps:{film:24,NTSC:29.97,NTSC_Film:23.98,NTSC_HD:59.94,PAL:25,PAL_HD:50,web:30,high:60}},b.prototype.toTime=function(e){var t="number"!=typeof e?this.video.currentTime:e,s=this.frameRate,i=new Date,n="hh:mm:ss"+("number"==typeof e?":ff":"");function r(e){return e<10?"0"+e:e}return i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(1e3*t),n.replace(/hh|mm|ss|ff/g,(function(e){switch(e){case"hh":return r(i.getHours()<13?i.getHours():i.getHours()-12);case"mm":return r(i.getMinutes());case"ss":return r(i.getSeconds());case"ff":return r(Math.floor(t%1*s))}}))},b.prototype.toSMPTE=function(e){if(!e)return this.toTime(this.video.currentTime);var t=Number(e),s=this.frameRate;function i(e){return e<10?"0"+e:e}var n=60*s,r=(t/(60*s*60)).toFixed(0),a=Number((t/n).toString().split(".")[0])%60,o=Number((t/s).toString().split(".")[0])%60;return i(r)+":"+i(a)+":"+i(o)+":"+i(t%s)},b.prototype.toSeconds=function(e){if(!e)return Math.floor(this.video.currentTime);var t=e.split(":");return 60*Number(t[0])*60+60*Number(t[1])+Number(t[2])},b.prototype.toMilliseconds=function(e){var t=Number(e?e.split(":")[3]:this.toSMPTE().split(":")[3]),s=1e3/this.frameRate*(isNaN(t)?0:t);return Math.floor(1e3*this.toSeconds(e)+s)},b.prototype.toFrames=function(e){var t=e?e.split(":"):this.toSMPTE().split(":"),s=this.frameRate,i=60*Number(t[0])*60*s,n=60*Number(t[1])*s,r=Number(t[2])*s,a=Number(t[3]);return Math.floor(i+n+r+a)},b.prototype.__seek=function(e,t){this.video.paused||this.video.pause();var s=Number(this.get());this.video.currentTime=("backward"===e?s-t:s+t)/this.frameRate+1e-5},b.prototype.seekForward=function(e,t){return e||(e=1),this.__seek("forward",Number(e)),!t||t()},b.prototype.seekBackward=function(e,t){return e||(e=1),this.__seek("backward",Number(e)),!t||t()},b.prototype.seekTo=function(e){var t,s,i=e||{},n=Object.keys(i)[0];if("SMPTE"==n||"time"==n)return s=i[n],t=this.toMilliseconds(s)/1e3+.001,void(this.video.currentTime=t);switch(n){case"frame":s=this.toSMPTE(i[n]),t=this.toMilliseconds(s)/1e3+.001;break;case"seconds":t=Number(i[n]);break;case"milliseconds":t=Number(i[n])/1e3+.001}isNaN(t)||(this.video.currentTime=t)};const w=b;class x extends p().ui.Element{static register(e){const t=e.mkid();return p().ui.Controls.registerElement(t,{create:(t,s)=>new x(t,s,e)}),t}constructor(e,t,s){super(e,t);const i=h("button",{className:"shaka-current-time"});if(e.appendChild(i),this.sxnd={env:s,currentTime:i},this.state={isReady:!1,activeMode:0,totalSeconds:0,duration:0,vifa:null,fps:null,chapters:null},this.eventManager){this.eventManager.listen(i,"click",(()=>{this.render({activeMode:(this.state.activeMode+1)%3})}));const e=this.updateTime.bind(this);this.eventManager.listen(this.controls,"timeandseekrangeupdated",e),this.eventManager.listen(this.controls,"sxnd-chapters",(e=>{const t=e.detail;this.render({chapters:t.chapters})})),this.eventManager.listen(this.controls,"sxnd-fps",(e=>{const t=e.detail;this.render({vifa:t.vifa,fps:t.fps})}))}}updateTime(){if(null===this.controls||null===this.video||this.video.readyState<1)this.render({isReady:!1});else{let e=this.video.duration;e>=0||(e=0),this.render({isReady:!0,duration:e,totalSeconds:i(this.controls.getDisplayTime(),[0,e])})}}render(e){const{env:t,currentTime:s}=this.sxnd,i=Object.assign({},this.state,e);if(Object.keys(e).some((t=>e[t]!==this.state[t]))){const e={0:"current-time",1:"remaining-time",2:"current-frame"}[i.activeMode]??"current-time";s.textContent=this.getTimecodeText(e,i),s.title=t.t(`control.time.${e}.tooltip`)}this.state=i}getTimecodeText(e,{isReady:t,totalSeconds:s,duration:i,vifa:n,fps:r,chapters:a}){if(t&&0!==i){const t=i>=3600,o={get chapterTitle(){return a?.timeToChapter(s)?.title??"_"},get currentTime(){return v(s,t,r)},get totalTime(){return v(i,t,r)},get remainingTime(){return v(i-s,t,r)},get currentFrame(){return n?.get()??-1}};return this.sxnd.env.t(`control.time.${e}.text`,o)}return this.sxnd.env.t("player.loading")}}class T extends p().ui.SettingsMenu{static register(e){const t=e.mkid();return p().ui.OverflowMenu.registerElement(t,{create:(t,s)=>new T(t,s,e)}),t}constructor(e,t,s){super(e,t,"switch_video"),this.sxnd={env:s,activeCheck:h("i",{className:"material-icons-round shaka-chosen-item"},["done"]),variantGroups:null},this.updateStrings(),this.updateVisibility(),this.menuButtons={},this.eventManager&&(this.eventManager.listen(this.controls,"sxnd-variant-groups",(e=>{const t=e.detail,s=this.sxnd.variantGroups=t.variantGroups;this.clearMenu(),this.updateVisibility();try{for(const e of s){const t=h("button",{$click:()=>{this.sxnd.variantGroups?.selectGroupByKey(e.key)}},[h("span",{},[e.key])]);this.menu.appendChild(t),this.menuButtons[e.key]=t}this.markActiveGroup()}catch(e){console.error(e)}})),this.eventManager.listen(this.player,"variantchanged",(()=>{this.markActiveGroup()})))}clearMenu(){for(const e of Object.values(this.menuButtons))e.remove();this.menuButtons={}}markActiveGroup(){const e=this.sxnd.variantGroups?.findActiveGroup();e&&(this.menuButtons[e.key]?.appendChild(this.sxnd.activeCheck),this.currentSelection.textContent=e.key)}updateVisibility(){(this.sxnd.variantGroups?.numGroups??0)>0?this.button.classList.remove("shaka-hidden"):this.button.classList.add("shaka-hidden")}updateStrings(){const e=this.sxnd.env.t("control.back"),t=this.sxnd.env.t("control.video-track.title");this.backButton.ariaLabel=e,this.button.ariaLabel=t,this.nameSpan.textContent=t,this.backSpan.textContent=t}}class C{static initSupport(){return p().polyfill.installAll(),p().Player.isBrowserSupported()?window.MediaSource&&window.MediaSource.isTypeSupported?["mpd","hls"]:["hls"]:[]}constructor(e){this.env=e,this.constants={prevChapterTolerance:5,minBottomControlsReadyState:2},this.mountPoint=null,this.container=h("div"),this.video=h("video",{id:this.env.mkid(),className:"sxnd-video"}),this.container.append(this.video),this.controlPanelButtons=[],this.overflowMenuButtons=[],this.player=new(p().Player)(this.video),this.ui=new(p().ui.Overlay)(this.player,this.container,this.video),this.controls=this.ui.getControls(),this.lastReadyState=0,this.shakaBottomControls=null,this.controlEventQueue=[],this.seekBar=null,this.vifa=null,this.fps=null,this.variantGroups=null,this.chapters=new d([]),this.handlers={onErrorEvent:this.onErrorEvent.bind(this),onTrackChange:this.onTrackChange.bind(this),onTimeUpdate:this.onTimeUpdate.bind(this)},this.player.addEventListener("error",this.handlers.onErrorEvent),this.controls.addEventListener("error",this.handlers.onErrorEvent),this.player.addEventListener("adaptation",this.handlers.onTrackChange),this.player.addEventListener("variantchanged",this.handlers.onTrackChange),this.controls.addEventListener("sxnd-seek-bar",(e=>{const t=e.detail;this.seekBar=t.seekBar})),this.controls.addEventListener("timeandseekrangeupdated",this.handlers.onTimeUpdate)}setConstants(e){Object.assign(this.constants,e)}setPoster(e){this.video.poster=e}addControlElement(...e){this.controlPanelButtons.push(...e)}addOverflowButton(...e){this.overflowMenuButtons.push(...e)}mount(e){return null!==this.mountPoint?(console.warn("Player already mounted"),!1):(k.register(),this.ui.configure({addSeekBar:!0,controlPanelElements:["play_pause","chapters_menu",x.register(this.env),"spacer","volume","mute",...this.controlPanelButtons,"fullscreen","overflow_menu"],overflowMenuButtons:["language",T.register(this.env),"playback_rate","loop","quality","picture_in_picture","captions",...this.overflowMenuButtons],addBigPlayButton:!0,seekBarColors:{base:"rgba(255, 255, 255, 0.3)",buffered:"rgba(255, 255, 255, 0.54)",played:"rgb(255, 255, 255)",adBreaks:"rgb(255, 204, 0)"}}),this.shakaBottomControls=this.container.querySelector(".shaka-bottom-controls"),e.replaceWith(this.container),this.mountPoint=e,!0)}get isMounted(){return null!==this.mountPoint}unmount(){null!==this.mountPoint&&(this.container.replaceWith(this.mountPoint),this.mountPoint=null)}async loadManifest(e,t=null){await this.player.load(e,t),this.variantGroups=new y(this.player),this.variantGroups.selectGroupWithPrimary()||this.variantGroups.selectGroupByRole("main")||this.variantGroups.selectGroupByIndex(0),this.emitControlEvent("sxnd-variant-groups",{variantGroups:this.variantGroups}),this.updateFrameRate()}onTrackChange(){this.updateFrameRate()}updateFrameRate(){const e=this.variantGroups?.findActiveTrack()?.frameRate??null;null===e?(this.fps=null,this.vifa=null):e!==this.fps&&(this.fps=e,this.vifa=new w({id:this.video.id,frameRate:e})),this.emitControlEvent("sxnd-fps",{vifa:this.vifa,fps:this.fps})}onTimeUpdate(){const e=this.video.readyState;e!==this.lastReadyState&&this.updateBottomControlsVisibility(e)}updateBottomControlsVisibility(e){0===e?this.shakaBottomControls?.classList.remove("sxnd-visible"):e>=this.constants.minBottomControlsReadyState&&this.shakaBottomControls?.classList.add("sxnd-visible")}isThumbnailPreviewOpen(){return this.seekBar?.isThumbnailPreviewOpen()??!1}hideThumbnailPreview(){this.seekBar?.hideThumbnailPreview()}anySettingsMenusAreOpen(){return this.controls.anySettingsMenusAreOpen()}hideSettingsMenus(){this.controls.hideSettingsMenus()}toggleFullScreen(){this.controls.toggleFullScreen()}setLocale(e){this.controls.getLocalization()?.changeLocale([e])}setChapters(e){this.chapters=e,this.emitControlEvent("sxnd-chapters",{chapters:e})}getCurrentChapter(){return this.timeToChapter(this.currentTime)}timeToChapter(e){return this.chapters.timeToChapter(e)}getVideo(){return this.video}get hasCurrentData(){return this.video.readyState>=2}get volume(){return this.video.volume}set volume(e){this.video.volume=i(e,[0,1])}get currentTime(){return this.video.currentTime}get displayTime(){return this.controls.getDisplayTime()}get muted(){return this.video.muted}set muted(e){this.video.muted=e}get paused(){return this.video.paused}play(){this.video.play()}pause(){this.video.pause()}getFps(){return this.fps}getVifa(){return this.vifa}seekTo(e){"number"==typeof e?this.video.currentTime=e:"number"==typeof e.timecode&&(this.video.currentTime=e.timecode)}skipSeconds(e){this.video.currentTime+=e}prevChapter(){const e=this.constants.prevChapterTolerance,t=this.chapters.timeToChapter(this.currentTime-e);this.seekTo(t??0)}nextChapter(){const e=this.getCurrentChapter();if(e){const t=this.chapters.advance(e,1);t&&this.seekTo(t)}}ensureTrickPlay(e){this.player.getPlaybackRate()!==e&&this.player.trickPlay(e)}cancelTrickPlay(){try{return this.player.cancelTrickPlay(),!0}catch(e){return!1}}emitControlEvent(e,t){this.controlEventQueue.push(new CustomEvent(e,{detail:t})),this.dispatchControlEvents()}dispatchControlEvents(){if(this.isMounted){for(const e of this.controlEventQueue)this.controls.dispatchEvent(e);this.controlEventQueue=[]}}onErrorEvent(e){if(e instanceof CustomEvent){const t=e.detail;console.error("Error code",t.code,"object",t)}}}var P=s(187),S=s.n(P);const M=jQuery;var E=s.n(M);class $ extends(S()){constructor(e){super(),this.state=e,this.pendingStateUpdates=[],this.renderTimeout=null,this.renderPromise=Promise.resolve()}setState(e={}){this.pendingStateUpdates.push(e),this.renderTimeout||(this.renderPromise=new Promise((e=>{this.renderTimeout=setTimeout((()=>{const t=this.squashStateUpdates(),s=Object.assign({},this.state,t);this.render(s),this.state=s,this.renderTimeout=null,this.renderPromise=Promise.resolve(),this.emit("updated",s),e()}))})))}update(){return this.renderPromise}squashStateUpdates(){const e=this.pendingStateUpdates.reduce(((e,t,s,i)=>Object.assign(e,t)),{});return this.pendingStateUpdates=[],e}render(e){}}class L extends ${constructor(e,t){super({show:!1,...t}),this.parent=e,this.isAnimating=!1,this.$main=h("div",{className:"sxnd-modal"},[this.$headline=h("div",{className:"headline-container"},[this.$title=h("h3"),this.$close=h("span",{className:"modal-close icon-close",$click:this.close.bind(this)})]),this.$body=h("div",{className:"body-container"})]),this.parent.append(this.$main),this.jqMain=E()(this.$main),this.resize()}resize(){this.$body.style.maxHeight=`calc(${this.parent.clientHeight}px - 11rem)`}get isOpen(){return this.state.show}open(e=!0){this.isAnimating||this.setState({show:e})}close(){this.open(!1)}toggle(){this.open(!this.state.show)}render(e){const{show:t}=e;if(t!=this.state.show){this.isAnimating=!0;const e=t?"show":"hide";this.jqMain[e]({duration:"fast",complete:()=>{this.isAnimating=!1}})}}}function I(e,t){const s=t.getLocation();return null!=e&&0!==e?s.searchParams.set("timecode",e.toString()):s.searchParams.delete("timecode"),s}class N extends L{constructor(e,t){super(e,{timecode:null,fps:0,startAtTimecode:!0}),this.env=t,this.$main.classList.add("bookmark-modal"),this.$title.innerText=this.env.t("modal.bookmark.title");const s=this.env.mkid();this.$body.append(h("div",{},[h("div",{className:"url-line"},[this.$urlInput=h("input",{type:"url",readOnly:!0,value:"https://sachsen.digital"}),h("a",{href:"javascript:void(0)",className:"copy-to-clipboard",title:this.env.t("modal.bookmark.copy-link"),$click:this.handleCopyToClipboard.bind(this)},[h("i",{className:"material-icons-round"},["content_copy"])])]),this.$startAt=h("div",{className:"start-at"},[this.$startAtCheck=h("input",{type:"checkbox",id:s,$change:this.handleChangeStartAtTimecode.bind(this)}),this.$startAtLabel=h("label",{htmlFor:s})])]))}async handleCopyToClipboard(){const e=this.generateUrl(this.state);this.$urlInput.focus(),navigator.clipboard?navigator.clipboard.writeText(e):document.execCommand("copy")}handleChangeStartAtTimecode(e){e.target instanceof HTMLInputElement&&this.setState({startAtTimecode:e.target.checked})}setTimecode(e){return this.setState({timecode:e}),this}setFps(e){return this.setState({fps:e}),this}generateUrl(e){return I(e.startAtTimecode?e.timecode:null,this.env).toString()}render(e){super.render(e);const{show:t,timecode:s,fps:i,startAtTimecode:n}=e;this.$urlInput.value=this.generateUrl(e),null===s||0===s?this.$startAt.classList.remove("shown"):(this.$startAtCheck.checked=n,this.$startAtLabel.innerText=this.env.t("modal.bookmark.start-at-current-time",{timecode:v(s,!0,i)}),this.$startAt.classList.add("shown")),t&&t!==this.state.show&&this.$urlInput.select()}}function B(e,t){return t.flatMap(((t,s)=>{const i=function(e,t){let s=t.mod?e.t(`key.mod.${t.mod}`)+" + "+e.t(`key.${t.key}.mod`):e.t(`key.${t.key}`);return t.repeat&&(s=e.t("key.repeat",{key:s})),s}(e,t);return[s>0&&h("span",{className:"or-sep"},[` ${e.t("or")} `]),h("span",{className:"kb-text"},[i])]}))}class O extends L{constructor(e,t,s){super(e,{}),this.env=t,this.config=s,this.createBodyDom()}createBodyDom(){const e=this.env;this.$body.classList.add("help-modal"),this.$title.innerText=e.t("modal.help.title");const t=function(e){const t={navigate:{},player:{},other:{}},s=e.slice();s.sort(((e,t)=>e.order-t.order));for(const e of s){let s=t[e.kind];s||(s=t[e.kind]={});let i=s[e.action];i||(i=s[e.action]=[]),i.push(e)}return t}(this.config.keybindings),s=Object.entries(t).flatMap((([t,s])=>{const i=[...Object.entries(s)];return 0===i.length?[]:[h("h3",{className:"subheader",innerText:e.t(`action.kind.${t}`)}),h("table",{className:"keybindings-table"},[h("tbody",{},[h("tr",{},[h("td",{className:"legend key"},[e.t("modal.help.key")]),h("td",{className:"legend action"},[e.t("modal.help.action")])]),...i.map((([t,s])=>h("tr",{},[h("td",{className:"key"},B(e,s)),h("td",{className:"action"},[this.describeAction(t)])])))])])]}));this.$body.append(...s)}describeAction(e){return this.env.t(`action.${e}`,this.config.constants)}}var A=s(8),F=s.n(A);class R{constructor(e){this.jpeg=e,this.exif=F().load(e)}static fromBinaryString(e){return new R(e)}toBinaryString(){const e=F().dump(this.exif);return F().insert(e,this.jpeg)}addMetadata(e){e.title&&(this.exif["0th"][F().ImageIFD.ImageDescription]=e.title),e.comment&&(this.exif.Exif[F().ExifIFD.UserComment]=e.comment)}getMetadata(){return{title:this.exif["0th"][F().ImageIFD.ImageDescription]??"",comment:this.exif.Exif[F().ExifIFD.UserComment]??""}}}const G=String.fromCharCode(137,80,78,71,13,10,26,10);class D{constructor(e,t){this.headerChunk=e,this.chunks=t}static createChunk(e){const t={};switch(e.type){case"raw":t.type=e.rawType,t.data=e.rawData;break;case"iTXt":t.type="iTXt",t.data=`${e.keyword.replace(/\0/g,"")}\0\0\0\0\0${e.text}`;break;case"IEND":t.type="IEND",t.data=""}return t.size=t.data.length,t.crc=function(e){for(var t=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],s=-1,i=0;i<e.length;i++)s=s>>>8^t[255&(s^e.charCodeAt(i))];return(-1^s)>>>0}(t.type+t.data),t}addChunk(e){const t=D.createChunk(e);if("iTXt"!==t.type)throw new Error(`Adding chunk type ${t.type} is not supported.`);this.chunks.unshift(t)}static fromBinaryString(e){if(!function(e){return e.substr(0,8)==G}(e.substr(0,8)))return;let t;e=e.substr(8);for(var s=[];""!=e;){var i={},n=j(e.substr(0,4));n<0&&(n=0);var r=e.substr(0,n+12);e=e.substr(n+12),i.size=n,i.type=r.substr(4,4),i.data=r.substr(8,n),i.crc=j(r.substr(8+n,4)),"IHDR"===i.type?t=i:"IEND"!==i.type&&s.push(i)}return void 0===t?void 0:new D(t,s)}toBinaryString(){var e=G;const t=t=>{var s="";s+=U(t.size,4),s+=t.type,s+=t.data,s+=U(t.crc,4),e+=s};t(this.headerChunk);for(const e of this.chunks)t(e);return t(D.createChunk({type:"IEND"})),e}addMetadata(e){for(const[t,s]of Object.entries(e)){if(!s)continue;const e={title:"Title",comment:"Comment"}[t];e&&this.addChunk({type:"iTXt",keyword:e,text:s})}}}function U(e,t){for(var s=[],i=t-1;i>=0;){var n=255&e;s[i--]=n,e>>=8}return s=s.map((function(e){return String.fromCharCode(e)})),s.join("")}function j(e){for(var t=0,s=0;s<e.length;s++)t=t<<8|255&e.charCodeAt(s);return t}const _=[{mimeType:"image/png",label:"PNG",parseBinaryString:e=>D.fromBinaryString(e)},{mimeType:"image/jpeg",label:"JPEG",parseBinaryString:e=>R.fromBinaryString(e)},{mimeType:"image/tiff",label:"TIFF",parseBinaryString:()=>{}}];class V extends L{constructor(e,t,s){const i=_.filter((e=>t.supportsCanvasExport(e.mimeType)));super(e,{metadata:null,showMetadata:!0,timecode:null,supportedImageFormats:i,selectedImageFormat:i[0]??null}),this.env=t,this.videoDomElement=null;const n=s.filter((e=>"modal.screenshot.snap"===e.action));this.$main.classList.add("screenshot-modal"),this.$title.innerText=t.t("modal.screenshot.title");const r=t.mkid(),a=t.mkid();var o;this.$body.append(h("div",{className:"screenshot-config"},[h("h4",{},[t.t("modal.screenshot.configuration")]),h("section",{className:"metadata-config"},[h("h1",{},[t.t("modal.screenshot.metadata")]),h("div",{className:"metadata-overlay"},[h("input",{type:"checkbox",id:r,checked:this.state.showMetadata,$change:this.handleChangeShowMetadata.bind(this)}),h("label",{htmlFor:r},[t.t("modal.screenshot.metadata-overlay")])])]),h("section",{},[h("h1",{},[t.t("modal.screenshot.file-format")]),h("div",{},this.state.supportedImageFormats.map((e=>{const s=t.mkid();return h("span",{className:"file-format-option"},[h("input",{id:s,name:a,type:"radio",checked:e.mimeType===this.state.selectedImageFormat?.mimeType,$change:()=>{this.setState({selectedImageFormat:e})}}),h("label",{htmlFor:s},[` ${e.label}`])])})))]),h("a",{href:"#",className:"download-link",$click:this.handleDownloadImage.bind(this)},[h("i",{className:"material-icons-round inline-icon"},["download"]),t.t("modal.screenshot.download-image")]),h("aside",{className:"snap-tip"},[h("i",{className:"material-icons-round inline-icon"},["info_outline"]),h("span",{innerHTML:(o=t.t("modal.screenshot.snap-tip",{keybinding:"{kb}"}),h("span",{innerText:o}).innerHTML).replace("{kb}",h("span",{},B(t,n)).outerHTML)})])]),this.$canvas=h("canvas"))}setVideo(e){return this.videoDomElement=e,this}setMetadata(e){return this.setState({metadata:e}),this}setTimecode(e){return this.setState({timecode:e}),this}handleChangeShowMetadata(e){e.target instanceof HTMLInputElement&&this.setState({showMetadata:e.target.checked})}async handleDownloadImage(e){e.preventDefault(),await this.downloadCurrentImage(this.state)}renderCurrentScreenshot({showMetadata:e,metadata:t}){if(null===this.videoDomElement)return!1;const s={captions:e?this.getCaptions(t):[],minWidth:1e3};return function(e,t,s){const[i,n]=e instanceof HTMLCanvasElement?[e,e.getContext("2d")]:[e.canvas,e];if(null===n)return!1;const r=Math.max(1,Math.ceil((s.minWidth??0)/t.videoWidth));i.width=t.videoWidth*r,i.height=t.videoHeight*r,n.drawImage(t,0,0,i.width,i.height);const a=i.height/1080,o=10*a;n.font=`${Math.floor(25*a)}px Arial`,n.fillStyle="#FFFFFF",n.shadowBlur=5,n.shadowColor="black";for(const e of s.captions??[]){const t="left"===e.h?o:i.width-o,s="top"===e.v?o:i.height-o;n.textAlign=e.h,n.fillText(e.text,t,s)}}(this.$canvas,this.videoDomElement,s),!0}async downloadCurrentImage(e){const{metadata:t,timecode:s,selectedImageFormat:i}=e;return null===t||null===s||null===i?(console.error("one of [metadata, timecode, selectedImageFormat] is null"),!1):(r(await this.makeImageBlob(this.$canvas,i,t,s),this.getFilename(t,s)),!0)}async makeImageBlob(e,t,s,i){const n=await function(e,t,s){return new Promise(((s,i)=>{e.toBlob((e=>{e?s(e):i()}),t,undefined)}))}(e,t.mimeType),r=await(a=n,new Promise(((e,t)=>{const s=new FileReader;s.onload=()=>{"string"==typeof s.result?e(s.result):t(null)},s.onerror=()=>{t(s.error)},s.readAsBinaryString(a)})));var a;const o=t.parseBinaryString(r);if(o){const e=I(i,this.env);o.addMetadata({title:s.metadata.title?.[0]??"",comment:`Screenshot taken on Sachsen.Digital.\n\n${e.toString()}`});const t=function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}(o.toBinaryString());return new Blob([t],{type:n.type})}return n}getFilename(e,t){return function(e){const t=e.replace(/[^a-zA-Z0-9()]+/g,"_");return t.length>0?t:"_"}(`Screenshot-${e.metadata.title?.[0]??"Unnamed"}-T${v(t,!0)}`)}getCaptions(e){return[{v:"bottom",h:"left",text:"https://sachsen.digital"},{v:"bottom",h:"right",text:e?(t=e,t.screenshotFields.map((e=>t.metadata[e]?.[0]??"")).join(" / ")):""}];var t}async snap(){await this.update();const e=this.state;this.renderCurrentScreenshot(e)&&await this.downloadCurrentImage(e)||alert(this.env.t("modal.screenshot.error"))}render(e){super.render(e),e.show&&(!this.state.show||e.showMetadata!==this.state.showMetadata)&&this.renderCurrentScreenshot(e)}}var W=s(15);class z{constructor(){this.idCnt=0,this.testCanvas=null,this.lang={twoLetterIsoCode:"en",phrasesInput:{},phrasesCompiled:{}}}getLocation(){return new URL(window.location.href)}supportsCanvasExport(e){return this.getTestCanvas().toDataURL(e).match(/data:(.*);/)?.[1]===e}mkid(){return"__autoid_"+ ++this.idCnt}setLang(e){this.lang={twoLetterIsoCode:e.twoLetterIsoCode,phrasesInput:e.phrases,phrasesCompiled:{}}}t(e,t={}){let s=this.lang.phrasesCompiled[e];if(void 0===s){const t=this.lang.phrasesInput[e];if(void 0===t)return console.error(`Warning: Translation key '${e}' not defined.`),e;s=this.lang.phrasesCompiled[e]=new W.ZP(t,this.lang.twoLetterIsoCode)}return s.format(t)}getTestCanvas(){return this.testCanvas||(this.testCanvas=document.createElement("canvas")),this.testCanvas}}const H=JSON.parse('[{"key":"Escape","action":"cancel","kind":"other","order":100},{"key":"F1","action":"modal.help.toggle","kind":"other","order":99},{"key":"b","scope":"player","action":"modal.bookmark.open","kind":"other","order":30},{"key":"s","scope":"player","action":"modal.screenshot.open","kind":"other","order":31},{"key":"s","mod":"Shift","scope":"player","action":"modal.screenshot.snap","kind":"other","order":32},{"key":"f","repeat":false,"scope":"player","action":"fullscreen.toggle","kind":"player","order":20},{"key":"t","repeat":false,"scope":"player","action":"theater.toggle","kind":"player","order":21},{"key":" ","repeat":false,"scope":"player","action":"playback.toggle","kind":"player","order":0},{"key":"m","repeat":false,"scope":"player","action":"playback.volume.mute.toggle","kind":"player","order":12},{"key":"ArrowUp","scope":"player","action":"playback.volume.inc","kind":"player","order":10},{"key":"ArrowDown","scope":"player","action":"playback.volume.dec","kind":"player","order":11},{"key":"ArrowLeft","repeat":false,"scope":"player","action":"navigate.rewind","kind":"navigate","order":0},{"key":"ArrowRight","repeat":false,"scope":"player","action":"navigate.seek","kind":"navigate","order":1},{"key":"ArrowLeft","repeat":true,"scope":"player","action":"navigate.continuous-rewind","kind":"navigate","order":2},{"key":"ArrowRight","repeat":true,"scope":"player","action":"navigate.continuous-seek","kind":"navigate","order":3},{"mod":"CtrlMeta","key":"ArrowLeft","scope":"player","action":"navigate.chapter.prev","kind":"navigate","order":10},{"mod":"CtrlMeta","key":"ArrowRight","scope":"player","action":"navigate.chapter.next","kind":"navigate","order":11},{"mod":"Shift","key":"ArrowLeft","scope":"player","action":"navigate.frame.prev","kind":"navigate","order":20},{"mod":"Shift","key":"ArrowRight","scope":"player","action":"navigate.frame.next","kind":"navigate","order":21},{"key":",","scope":"player","action":"navigate.frame.prev","kind":"navigate","order":20},{"key":".","scope":"player","action":"navigate.frame.next","kind":"navigate","order":21}]');window.SxndPlayerApp=class{constructor(e,t,s){this.container=e,this.playerMount=h("div"),this.container.append(this.playerMount),this.videoInfo=t,this.lang=s,this.keybindings=H,this.constants={prevChapterTolerance:5,volumeStep:.05,seekStep:10,trickPlayFactor:4,forceLandscapeOnFullscreen:!0},this.handlers={onKeyDown:this.onKeyDown.bind(this),onKeyUp:this.onKeyUp.bind(this),onClickChapterLink:this.onClickChapterLink.bind(this),onPlay:this.onPlay.bind(this),onCloseModal:this.onCloseModal.bind(this)},this.env=new z,this.env.setLang(s),this.sxndPlayer=new C(this.env),this.manifestUri=null;for(const e of C.initSupport())if(t.url[e]){this.manifestUri=t.url[e];break}this.chapterLinks=[],this.modals=function(e){const t=Object.values(e),s=document.createElement("div");s.className="sxnd-modal-cover",s.addEventListener("click",(()=>{n.closeAll()})),document.body.append(s);const i={toggleExclusive:e=>{e.isOpen?e.close():n.hasOpen()||e.open()},setFullscreen:e=>{(e??document.body).append(s)},hasOpen:()=>t.some((e=>e.isOpen)),closeNext:()=>{for(const e of t)if(e.isOpen){e.close();break}},closeAll:()=>{for(const e of t)e.close()},update:async()=>{await Promise.all(t.map((e=>e.update())))},resize:()=>{for(const e of t)e.resize()}},n=Object.assign(new(S()),e,i);window.addEventListener("resize",(()=>{n.resize()})),document.addEventListener("fullscreenchange",(()=>{n.setFullscreen(document.fullscreenElement)}));for(const e of t)e.on("updated",(()=>{e.isOpen||n.emit("closed",e),n.hasOpen()?s.classList.add("shown"):s.classList.remove("shown")}));return n}({help:new O(this.container,this.env,{constants:{...this.constants,forceLandscapeOnFullscreen:Number(this.constants.forceLandscapeOnFullscreen)},keybindings:this.keybindings}),bookmark:new N(this.container,this.env),screenshot:new V(this.container,this.env,this.keybindings)}),this.sxnd={pausedOn:null},this.actions={cancel:()=>{this.modals.hasOpen()?this.modals.closeNext():this.sxndPlayer.isThumbnailPreviewOpen()?this.sxndPlayer.hideThumbnailPreview():this.sxndPlayer.anySettingsMenusAreOpen()&&this.sxndPlayer.hideSettingsMenus()},"modal.help.open":()=>{this.openModal(this.modals.help,!1)},"modal.help.toggle":()=>{this.sxndPlayer.hideThumbnailPreview(),this.modals.toggleExclusive(this.modals.help)},"modal.bookmark.open":()=>{this.showBookmarkUrl()},"modal.screenshot.open":()=>{this.showScreenshot()},"modal.screenshot.snap":()=>{this.snapScreenshot()},"fullscreen.toggle":()=>{this.sxndPlayer.hideThumbnailPreview(),this.toggleFullScreen()},"theater.toggle":()=>{this.sxndPlayer.hideThumbnailPreview();const e=new CustomEvent("dlf-theater-mode",{detail:{action:"toggle",persist:!0}});window.dispatchEvent(e)},"playback.toggle":()=>{this.sxndPlayer.paused?this.sxndPlayer.play():this.sxndPlayer.pause()},"playback.volume.mute.toggle":()=>{this.sxndPlayer.muted=!this.sxndPlayer.muted},"playback.volume.inc":()=>{this.sxndPlayer.volume=this.sxndPlayer.volume+this.constants.volumeStep},"playback.volume.dec":()=>{this.sxndPlayer.volume=this.sxndPlayer.volume-this.constants.volumeStep},"navigate.rewind":()=>{this.sxndPlayer.skipSeconds(-this.constants.seekStep)},"navigate.seek":()=>{this.sxndPlayer.skipSeconds(+this.constants.seekStep)},"navigate.continuous-rewind":()=>{this.sxndPlayer.ensureTrickPlay(-this.constants.trickPlayFactor)},"navigate.continuous-seek":()=>{this.sxndPlayer.ensureTrickPlay(this.constants.trickPlayFactor)},"navigate.chapter.prev":()=>{this.sxndPlayer.prevChapter()},"navigate.chapter.next":()=>{this.sxndPlayer.nextChapter()},"navigate.frame.prev":()=>{this.sxndPlayer.getVifa()?.seekBackward(1)},"navigate.frame.next":()=>{this.sxndPlayer.getVifa()?.seekForward(1)}},this.modals.on("closed",this.handlers.onCloseModal),this.sxndPlayer.getVideo().addEventListener("play",this.handlers.onPlay),this.load()}failWithError(e){this.sxndPlayer.unmount();const t=h("div",{className:"sxnd-player-fatal-error"},[this.env.t(e)]);this.container.innerHTML="",this.container.append(t)}getStartTime(e){const t=this.env.getLocation().searchParams.get("timecode");return null!==t?t?parseFloat(t):void 0:void 0!==this.videoInfo.pageNo?e.at(this.videoInfo.pageNo-1)?.timecode:void 0}getLinkTimecode(e){const t=e.getAttribute("data-timecode");if(null!==t){const e=Number(t);if(Number.isFinite(e))return e}const s=e.hash.match(/timecode=(\d+(\.\d?)?)/);if(null!==s){const e=Number(s[1]);if(Number.isFinite(e))return e}return null}async load(){if(null===this.manifestUri)return void this.failWithError("error.playback-not-supported");document.querySelectorAll("a[data-timecode], .tx-dlf-tableofcontents a").forEach((e=>{const t=e,s=this.getLinkTimecode(t);if(null!==s){const t=e;t.sxndTimecode=s,t.addEventListener("click",this.handlers.onClickChapterLink),this.chapterLinks.push(t)}}));const e=this.videoInfo.chapters.map((e=>({...e,timecode:parseInt(e.timecode,10)}))),t=new d(e),s=this.getStartTime(t);this.sxndPlayer.addControlElement(m.register(this.env,{className:"sxnd-screenshot-button",material_icon:"photo_camera",title:this.env.t("control.screenshot.tooltip"),onClick:this.actions["modal.screenshot.open"]}),m.register(this.env,{className:"sxnd-bookmark-button",material_icon:"bookmark_border",title:this.env.t("control.bookmark.tooltip"),onClick:this.actions["modal.bookmark.open"]}),m.register(this.env,{className:"sxnd-help-button",material_icon:"help_outline",title:this.env.t("control.help.tooltip"),onClick:this.actions["modal.help.open"]})),this.sxndPlayer.setConstants(this.constants),this.sxndPlayer.setLocale(this.lang.twoLetterIsoCode),this.sxndPlayer.setPoster(this.videoInfo.url.poster),this.sxndPlayer.setChapters(t),this.sxndPlayer.mount(this.playerMount);try{await this.sxndPlayer.loadManifest(this.manifestUri,s)}catch(e){console.error(e),this.failWithError("error.load-failed")}this.modals.resize(),document.addEventListener("keydown",this.handlers.onKeyDown,{capture:!0}),document.addEventListener("keyup",this.handlers.onKeyUp,{capture:!0})}getKeyboardScope(){if(this.modals.hasOpen())return"modal";for(const e of Array.from(document.querySelectorAll("input:focus")))if(e instanceof HTMLElement&&null!==e.offsetParent)return"input";return"player"}onKeyDown(e){let t=!0;const s=function(e){let t=c.None;return(e.ctrlKey||e.metaKey)&&(t|=c.CtrlMeta),e.shiftKey&&(t|=c.Shift),e.altKey&&(t|=c.Alt),t}(e),i=this.getKeyboardScope(),n=this.keybindings.find((t=>!("function"!=typeof this.actions[t.action]||t.key.toLowerCase()!==e.key.toLowerCase()||null!=t.repeat&&t.repeat!==e.repeat||null!=t.scope&&t.scope!==i||c[t.mod??"None"]!==s)));n&&(e.preventDefault(),this.actions[n.action](),!0===n.propagate&&(t=!1)),t&&e.stopImmediatePropagation()}onKeyUp(e){e.stopImmediatePropagation(),this.sxndPlayer.cancelTrickPlay()}onClickChapterLink(e){e.preventDefault();const t=e.currentTarget;this.sxndPlayer.play(),this.sxndPlayer.seekTo(t.sxndTimecode)}onPlay(){this.sxnd.pausedOn=null}pauseOn(e){null!==this.sxnd.pausedOn||this.sxndPlayer.paused||(this.sxnd.pausedOn=e,this.sxndPlayer.pause())}resumeOn(e){this.sxnd.pausedOn===e&&(this.sxndPlayer.play(),this.sxnd.pausedOn=null)}onCloseModal(e){this.resumeOn(e)}async toggleFullScreen(){if(document.fullscreenElement)screen.orientation&&screen.orientation.unlock(),await document.exitFullscreen();else try{if(document.pictureInPictureElement&&await document.exitPictureInPicture(),await this.container.requestFullscreen({navigationUI:"hide"}),this.constants.forceLandscapeOnFullscreen&&screen.orientation)try{await screen.orientation.lock("landscape")}catch(e){}}catch(e){console.log(e)}}showBookmarkUrl(){if(!this.sxndPlayer.hasCurrentData)return;const e=this.modals.bookmark.setTimecode(this.sxndPlayer.displayTime).setFps(this.sxndPlayer.getFps()??0);this.openModal(e,!0)}prepareScreenshot(){return this.sxndPlayer.hasCurrentData?this.modals.screenshot.setVideo(this.sxndPlayer.getVideo()).setMetadata(this.videoInfo.metadata).setTimecode(this.sxndPlayer.displayTime):null}showScreenshot(){const e=this.prepareScreenshot();null!==e&&this.openModal(e,!0)}snapScreenshot(){const e=this.prepareScreenshot();null!==e&&e.snap()}openModal(e,t){t&&this.pauseOn(e),this.sxndPlayer.hideThumbnailPreview(),e.open()}}}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var r=s[e]={exports:{}};return t[e](r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,s,n,r)=>{if(!s){var a=1/0;for(c=0;c<e.length;c++){for(var[s,n,r]=e[c],o=!0,h=0;h<s.length;h++)(!1&r||a>=r)&&Object.keys(i.O).every((e=>i.O[e](s[h])))?s.splice(h--,1):(o=!1,r<a&&(a=r));if(o){e.splice(c--,1);var l=n();void 0!==l&&(t=l)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[s,n,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={825:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,r,[a,o,h]=s,l=0;if(a.some((t=>0!==e[t]))){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(h)var c=h(i)}for(t&&t(s);l<a.length;l++)r=a[l],i.o(e,r)&&e[r]&&e[r][0](),e[a[l]]=0;return i.O(c)},s=self.webpackChunkslub_web_sachsendigital=self.webpackChunkslub_web_sachsendigital||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=i.O(void 0,[276],(()=>i(465)));n=i.O(n)})();
//# sourceMappingURL=SxndPlayerApp.js.map