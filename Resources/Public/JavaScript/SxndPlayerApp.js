(()=>{"use strict";var e,t={692:(e,t,n)=>{const s=jQuery;var r=n.n(s),i=n(480),a=n.n(i);class o{constructor(e,t={}){this._parent=e,this._isAnimating=!1,this._state={show:!1,...t},this._dom=this._createDom(),this._dom.close.addEventListener("click",this.close.bind(this)),this._parent.append(this._dom.main),this._$main=r()(this._dom.main)}_createDom(e=""){const t={main:document.createElement("div"),headline:document.createElement("div"),title:document.createElement("h3"),close:document.createElement("span"),body:document.createElement("div")};return t.main.className=`sxnd-modal ${e}`,t.headline.className="headline-container",t.close.className="modal-close icon-close",t.body.className="body-container",t.main.append(t.headline,t.body),t.headline.append(t.title,t.close),t}get isOpen(){return this._state.show}open(e=!0){this._isAnimating||this.setState({show:e})}close(){this.open(!1)}toggle(){this.open(!this._state.show)}setState(e={}){const t=Object.assign({},this._state,e);this.render(t),this._state=t}render(e){const{show:t}=e;if(t!=this._state.show){this._isAnimating=!0;const e=t?"show":"hide";this._$main[e]({duration:"fast",complete:()=>{this._isAnimating=!1}})}}}class d extends o{constructor(e){super(e,{timecode:null})}_createDom(){const e=super._createDom("bookmark-modal");return e.title.innerText="Bookmark-URL",e.url=document.createElement("input"),e.url.type="url",e.url.value="https://sachsen.digital",e.body.append(e.url),e}setTimecode(e){return this.setState({timecode:e}),this}render(e){super.render(e);const{show:t,timecode:n}=e;if(null!==n&&n!==this._state.timecode){const t=new URL(window.location);t.searchParams.set("timecode",e.timecode),this._dom.url.value=t.toString()}t&&t!==this._state.show&&this._dom.url.select()}}let c=0;class l{constructor(e){this._chapters=e.map((e=>({id:c++,title:e.title,timecode:parseInt(e.timecode,10)}))),this._chapters.sort(((e,t)=>e.timecode-t.timecode)),this._idToIndex=new Map;for(let e=0;e<this._chapters.length;e++){const t=this._chapters[e];this._idToIndex.set(t.id,e)}}at(e){return this._chapters[e]}indexOf(e){return this._idToIndex.get(e.id)}advance(e,t=1){let n=this.indexOf(e);if(void 0!==n)return this._chapters[n+t]}timeToChapter(e){for(let t=this._chapters.length-1;t>=0;t--){const n=this._chapters[t];if(e>=n.timecode)return n}}[Symbol.iterator](){return this._chapters.values()}}class h extends o{_createDom(){const e=super._createDom("help-modal");return e.title.innerText="Tastaturbelegung",e.body.innerHTML='\n      <table>\n        <tbody>\n          <tr>\n            <td class="legend">Taste</td>\n            <td class="legend">Funktion</td>\n          </tr>\n          <tr>\n            <td>Leertaste</td>\n            <td>Abspielen / Pausieren</td>\n          </tr>\n          <tr>\n            <td>Taste F</td>\n            <td>Vollbild an / aus</td>\n          </tr>\n          <tr>\n            <td>Pfeil rechts</td>\n            <td>10 Sekunden weiter</td>\n          </tr>\n          <tr>\n            <td>Pfeil links</td>\n            <td>10 Sekunden zurück</tr>\n          </tr>\n          <tr>\n            <td>Strg + rechts</td>\n            <td>Kapitel weiter</td>\n          </tr>\n          <tr>\n            <td>Strg + links</td>\n            <td>Kapitel zurück</td>\n          </tr>\n          <tr>\n            <td>Umschalt + rechts <em>oder</em> Punkt</td>\n            <td>Einzelbild weiter</td>\n          </tr>\n          <tr>\n            <td>Umschalt + links <em>oder</em> Komma</td>\n            <td>Einzelbild zurück</td>\n          </tr>\n          <tr>\n            <td>Pfeil oben</td>\n            <td>Lautstärke erhöhen</td>\n          </tr>\n          <tr>\n            <td>Pfeil unten</td>\n            <td>Lautstärke verringern</td>\n          </tr>\n          <tr>\n            <td>Taste M</td>\n            <td>Stummschaltung an / aus</td>\n          </tr>\n          <tr>\n            <td>Taste B</td>\n            <td>Bookmark-Link anzeigen</td>\n          </tr>\n          <tr>\n            <td>Taste S</td>\n            <td>Screenshot anzeigen</td>\n          </tr>\n          <tr>\n            <td>F1</td>\n            <td>Hilfe (dieses Fenster)</td>\n          </tr>\n          <tr>\n            <td>Escape</td>\n            <td>Aktuelle Aktion beenden (Fenster, Vollbild, ...)</td>\n          </tr>\n        </tbody>\n      </table>\n    ',e}}class u extends o{constructor(e,t){super(e,{showMetadata:!0}),this._videoDomElement=t}_createDom(){const e=super._createDom("screenshot-modal");e.title.innerText="Screenshot";const t=document.createElement("template");return t.innerHTML='\n      <div class="screenshot-config">\n        <input type="checkbox" id="cb-show-metadata" class="show-metadata">\x3c!--\n        --\x3e<label for="cb-show-metadata"> Metadaten einblenden</label>\n\n        ·\n\n        <a href="#" class="download-image">Bild herunterladen</a>\n      </div>\n    ',e.config=t.content.firstElementChild,e.showMetadata=e.config.querySelector(".show-metadata"),e.showMetadata.checked=this._state.showMetadata,e.showMetadata.addEventListener("change",this.handleChangeShowMetadata.bind(this)),e.downloadImage=e.config.querySelector(".download-image"),e.downloadImage.addEventListener("click",this.handleDownloadImage.bind(this)),e.body.append(e.config),e.canvas=document.createElement("canvas"),e.body.append(e.canvas),e}handleChangeShowMetadata(e){this.setState({showMetadata:e.target.checked})}handleDownloadImage(e){e.preventDefault();const t=document.createElement("a");t.href=this._dom.canvas.toDataURL(),t.download="screenshot.png",t.click()}render(e){super.render(e);const{show:t,showMetadata:n}=e;if(t){const e=n?window.VIDEO.metadata:{metadata:{},screenshotFields:[]};!function(e,t,n){const[s,r]=e instanceof HTMLCanvasElement?[e,e.getContext("2d")]:[e.canvas,e],i=n.screenshotFields.map((e=>n.metadata[e])).filter((e=>"string"==typeof e)).join(" / ");s.width=t.videoWidth,s.height=t.videoHeight,r.drawImage(t,0,0,s.width,s.height);const a=s.height/1080,o=10*a;r.font=`${Math.floor(25*a)}px Arial`,r.textAlign="end",r.fillStyle="#FFFFFF",r.shadowBlur=5,r.shadowColor="black",r.fillText(i,s.width-o,s.height-o)}(this._dom.canvas,this._videoDomElement,e)}}}class m extends a().ui.Element{static KEY="capture";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="Screenshot",this.button_.textContent="photo_camera",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.showScreenshot()}))}}function p(e,t){return(t?[e/3600,e/60%60,e%60]:[e/60,e%60]).map(((e,t)=>Math.floor(e).toString().padStart(0==t?0:2,"0"))).join(":")}m.Factory=class{create(e,t){return new m(e,t)}},a().ui.Controls.registerElement(m.KEY,new m.Factory);class v extends a().ui.Element{static KEY="time_and_duration_frame";constructor(e,t){super(e,t),this.currentTime_=document.createElement("button"),this.currentTime_.classList.add("shaka-current-time"),this.parent.appendChild(this.currentTime_),this.state={},this.render({totalSeconds:0,activeMode:0}),this.eventManager.listen(this.currentTime_,"click",(()=>{this.render({activeMode:(this.state.activeMode+1)%3})})),this.eventManager.listen(this.controls,"timeandseekrangeupdated",(()=>{this.render({totalSeconds:this.controls.getDisplayTime()})}))}render(e){const t=Object.assign({},this.state,e),{totalSeconds:n,activeMode:s}=t;if(n!==this.state.totalSeconds||s!==this.state.activeMode){const e=this.controls.elSxndPlayer,t=e.video.duration>=3600;let r,i;switch(s){default:r=p(n,t),e.vifa&&(r+=":"+("0"+e.vifa.get()%e.fps).slice(-2)),e.video.duration&&(r+=" / "+p(e.video.duration,t)),i="Aktuelle Laufzeit / Gesamtlaufzeit";break;case 1:r=p(e.video.duration-n,t),i="Restlaufzeit";break;case 2:r=`${e.vifa.get()}`,i="Frame-Nummer"}let a=e.chapters.timeToChapter(n);a&&(r+=` – ${a.title}`),this.currentTime_.textContent=r,this.currentTime_.title=i}this.state=t}}v.Factory=class{create(e,t){return new v(e,t)}},a().ui.Controls.registerElement(v.KEY,new v.Factory);class b extends a().ui.Element{static KEY="replay_10";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="10 Sekunden zurück",this.button_.textContent="replay_10",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.skipSeconds(-10)}))}}b.Factory=class{create(e,t){return new b(e,t)}},a().ui.Controls.registerElement(b.KEY,new b.Factory);class f extends a().ui.Element{static KEY="skip_previous";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="Einzelbild zurück",this.button_.textContent="skip_previous",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.vifa.seekBackward(1)}))}}f.Factory=class{create(e,t){return new f(e,t)}},a().ui.Controls.registerElement(f.KEY,new f.Factory);class k extends a().ui.Element{static KEY="skip_next";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="Einzelbild weiter",this.button_.textContent="skip_next",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.vifa.seekForward(1)}))}}k.Factory=class{create(e,t){return new k(e,t)}},a().ui.Controls.registerElement(k.KEY,new k.Factory);class w extends a().ui.Element{static KEY="forward_10";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="10 Sekunden vor",this.button_.textContent="forward_10",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>{this.controls.elSxndPlayer.skipSeconds(10)}))}}w.Factory=class{create(e,t){return new w(e,t)}},a().ui.Controls.registerElement(w.KEY,new w.Factory);class _ extends a().ui.Element{static KEY="bookmark";constructor(e,t){super(e,t),this.button_=document.createElement("button"),this.button_.className="material-icons-round",this.button_.title="Bookmark",this.button_.textContent="bookmark_border",this.parent.appendChild(this.button_),this.eventManager.listen(this.button_,"click",(()=>this.controls.elSxndPlayer.showBookmarkUrl()))}}let y,g;_.Factory=class{create(e,t){return new _(e,t)}},a().ui.Controls.registerElement(_.KEY,new _.Factory);class E{constructor(e){this.container=e.container,this.video=e.video,this.manifestUri=e.manifestUri,this.initialTimecode=e.timecode}async initialize(){this.chapters=new l(window.VIDEO.chapters),this.fps=25,this.player=new(a().Player)(this.video);const e=new(a().ui.Overlay)(this.player,this.container,this.video);this.controls=e.getControls(),this.controls.getLocalization().changeLocale([window.LANG]),this.controls.elSxndPlayer=this;const t={addSeekBar:!0,controlPanelElements:["play_pause","chapters_menu",v.KEY,"spacer","volume","mute",b.KEY,f.KEY,k.KEY,w.KEY,m.KEY,_.KEY,"fullscreen","overflow_menu"],overflowMenuButtons:["language","playback_rate","loop","quality","picture_in_picture","captions"],addBigPlayButton:!0,seekBarColors:{base:"rgba(255, 255, 255, 0.3)",buffered:"rgba(255, 255, 255, 0.54)",played:"rgb(255, 255, 255)",adBreaks:"rgb(255, 204, 0)"}};e.configure(t),this.player.addEventListener("error",this.onPlayerErrorEvent.bind(this)),this.controls.addEventListener("error",this.onUiErrorEvent.bind(this)),this.vifa=VideoFrame({id:this.video.id,frameRate:this.fps,callback:function(e){console.log("callback response: "+e)}});try{console.log("The video has now been loaded!"),await this.player.load(this.manifestUri,this.initialTimecode)}catch(e){onError(e)}this.renderChapterMarkers()}renderChapterMarkers(){const e=document.querySelector(".shaka-seek-bar-container");for(const t of this.chapters){const n=t.timecode/this.video.duration;if(!(0<=n&&n<1))continue;const s=document.createElement("span");s.className="sxnd-chapter-marker",s.style.position="absolute",s.style.left=t.timecode/this.video.duration*100+"%",s.title=t.title,s.addEventListener("click",(()=>{this.play(),this.seekTo(t)}));const r=document.createElement("span");s.append(r),e.append(s)}}onPlayerErrorEvent(e){this.onPlayerError(e.detail)}onUiErrorEvent(e){this.onPlayerError(e.detail)}onPlayerError(e){console.error("Error code",e.code,"object",e)}get currentTime(){return this.video.currentTime}get displayTime(){return this.controls.getDisplayTime()}getCurrentChapter(){return this.timeToChapter(this.currentTime)}timeToChapter(e){return this.chapters.timeToChapter(e)}play(){this.video.play()}pause(){this.video.pause()}seekTo(e){null!=e&&("number"==typeof e?this.video.currentTime=e:"number"==typeof e.timecode&&(this.video.currentTime=e.timecode))}skipSeconds(e){this.video.currentTime+=e}prevChapter(){this.seekTo(this.timeToChapter(this.currentTime-5)??0)}nextChapter(){let e=this.getCurrentChapter();e&&this.seekTo(this.chapters.advance(e,1))}showBookmarkUrl(){this.pause(),y.bookmark.setTimecode(this.displayTime).open()}showScreenshot(){this.pause(),y.screenshot.open()}}document.addEventListener("shaka-ui-loaded",(()=>{const e=document.querySelector(".mediaplayer-container"),t=document.createElement("video");t.id="video",t.poster=window.VIDEO.url.poster,t.style.width="100%",t.style.height="100%",e.append(t);const n=new URL(window.location).searchParams.get("timecode");g=new E({container:e,video:document.getElementById("video"),manifestUri:window.VIDEO.url.manifest,timecode:n?parseFloat(n):void 0}),g.initialize(),r()("a[data-timecode]").on("click",(function(){const e=r()(this).data("timecode");g.play(),g.seekTo(e)})),y=function(e){const t=Object.assign({},e),n=Object.values(e);return t.hasOpen=()=>n.some((e=>e.isOpen)),t.closeNext=()=>{for(const e of n)if(e.isOpen){e.close();break}},t}({help:new h(e),bookmark:new d(e),screenshot:new u(e,g.video)}),document.addEventListener("keydown",(e=>{"F1"==e.key?(e.preventDefault(),y.help.toggle()):"Escape"==e.key&&(e.preventDefault(),y.closeNext()),y.hasOpen()||("f"==e.key?(e.preventDefault(),g.controls.toggleFullScreen()):" "==e.key?(e.preventDefault(),g.video.paused?g.video.play():g.video.pause()):"ArrowUp"==e.key?(e.preventDefault(),g.video.volume=Math.min(1,g.video.volume+.05)):"ArrowDown"==e.key?(e.preventDefault(),g.video.volume=Math.max(0,g.video.volume-.05)):"ArrowLeft"==e.key?(e.preventDefault(),e.ctrlKey||e.metaKey?g.prevChapter():e.shiftKey?g.vifa.seekBackward(1):g.skipSeconds(-10)):"ArrowRight"==e.key?(e.preventDefault(),e.ctrlKey||e.metaKey?g.nextChapter():e.shiftKey?g.vifa.seekForward(1):g.skipSeconds(10)):"m"==e.key?(e.preventDefault(),g.video.muted=!g.video.muted):"."==e.key?(e.preventDefault(),g.vifa.seekForward(1)):","==e.key?(e.preventDefault(),g.vifa.seekBackward(1)):"b"==e.key?(e.preventDefault(),g.showBookmarkUrl()):"s"==e.key&&(e.preventDefault(),g.showScreenshot()))}))})),document.addEventListener("shaka-ui-load-failed",(e=>{console.error("Unable to load the UI library!")}))}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,s),i.exports}s.m=t,e=[],s.O=(t,n,r,i)=>{if(!n){var a=1/0;for(l=0;l<e.length;l++){for(var[n,r,i]=e[l],o=!0,d=0;d<n.length;d++)(!1&i||a>=i)&&Object.keys(s.O).every((e=>s.O[e](n[d])))?n.splice(d--,1):(o=!1,i<a&&(a=i));if(o){e.splice(l--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[n,r,i]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={825:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[a,o,d]=n,c=0;if(a.some((t=>0!==e[t]))){for(r in o)s.o(o,r)&&(s.m[r]=o[r]);if(d)var l=d(s)}for(t&&t(n);c<a.length;c++)i=a[c],s.o(e,i)&&e[i]&&e[i][0](),e[a[c]]=0;return s.O(l)},n=self.webpackChunkslub_web_sachsendigital=self.webpackChunkslub_web_sachsendigital||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=s.O(void 0,[276],(()=>s(692)));r=s.O(r)})();
//# sourceMappingURL=SxndPlayerApp.js.map