/*! For license information please see SxndPlayerApp.js.LICENSE.txt */
(()=>{"use strict";var t,e={330:(t,e,s)=>{function i(t,[e,s]){return t<e?e:t>s?s:t}function n(t){return new Promise(((e,s)=>{const i=document.createElement("img");i.onload=()=>{e(i)},i.onerror=s,i.src=t}))}function r(t,e){"string"==typeof t?o("a",{href:t,download:e}).click():a(t,(t=>{r(t,e)}))}function a(t,e){const s=URL.createObjectURL(t);let i;try{i=e(s)}catch(t){throw URL.revokeObjectURL(s),t}if(i instanceof Promise){const t=i;return new Promise(((e,i)=>{t.then((t=>{URL.revokeObjectURL(s),e(t)})).catch((t=>{URL.revokeObjectURL(s),i(t)}))}))}return URL.revokeObjectURL(s),i}function o(t,e={},s=[]){const i=document.createElement(t);for(const[t,s]of Object.entries(e))"$"===t[0]?i.addEventListener(t.substring(1),s):i[t]=s;for(const t of s)"string"==typeof t?i.append(document.createTextNode(t)):t instanceof HTMLElement&&i.append(t);return i}const h={None:0,CtrlMeta:1,Shift:2,Alt:4};class l{constructor(t){this.chapters=t.slice(),this.chapters.sort(((t,e)=>t.timecode-e.timecode)),this.chapterToIndex=new Map;for(const[t,e]of this.chapters.entries())this.chapterToIndex.set(e,t)}at(t){return this.chapters[t]}indexOf(t){return this.chapterToIndex.get(t)}advance(t,e=1){const s=this.indexOf(t);if(void 0!==s)return this.chapters[s+e]}timeToChapter(t){for(const e of this.reversed())if(t>=e.timecode)return e}[Symbol.iterator](){return this.chapters.values()}*reversed(){for(let t=this.chapters.length-1;t>=0;t--)yield this.chapters[t]}}var c=s(480),d=s.n(c);class u extends d().ui.Element{static register(t,e={}){const s=t.mkid();return d().ui.Controls.registerElement(s,{create:(t,s)=>new u(t,s,e)}),s}constructor(t,e,s={}){super(t,e);const i=o("button",{className:"material-icons-round"},[s.material_icon]);t.appendChild(i),this.sxnd={config:s,button:i},this.eventManager&&s.onClick&&this.eventManager.listen(i,"click",s.onClick),this.updateStrings()}updateStrings(){this.sxnd.button.title=this.sxnd.config.title??""}}class p{constructor(){this.tasks={}}get(t){let e=this.tasks[t];if(void 0===e){this.abortPending();const s=new AbortController,i=new Promise(((e,i)=>{this.fetchImage(t,s.signal).then((s=>{const i=this.tasks[t];i&&(i.loaded=!0,i.response=s,e(s))})).catch((e=>{delete this.tasks[t],i(e)}))}));e=this.tasks[t]={abortController:s,promise:i,loaded:!1}}return e.promise}abortPending(){for(const[t,e]of Object.entries(this.tasks))e.loaded||(e.abortController.abort(),delete this.tasks[t])}async fetchImage(t,e){const s=await fetch(t,{signal:e});if(s.ok){const t=await s.blob(),e=await function(t){return a(t,n)}(t);return e}throw s}}function m(t,e,s=null){const i=e?[t/3600,t/60%60,t%60]:[t/60,t%60];return s&&i.push(Math.floor(t%1*s)),i.map(((t,e)=>Math.floor(t).toString().padStart(0==e?0:2,"0"))).join(":")}class v{constructor(t){this.seekBar=t.seekBar,this.player=t.player,this.network=t.network,this.interaction=t.interaction,this.fps=null,this.chapters=null,this.imageTracks=[],this.lastRendered=null,this.isChanging=!1,this.showContainer=!1,this.handlers={onWindowBlur:this.onWindowBlur.bind(this),onPointerMove:this.onPointerMove.bind(this),onPointerDown:this.onPointerDown.bind(this),onPointerUp:this.onPointerUp.bind(this)},this.$container=o("div",{className:"sxnd-thumbnail-preview noselect"},[o("div",{className:"content-box"},[this.$display=o("div",{className:"display"},[this.$canvas=o("canvas")]),this.$info=o("span",{className:"info"},[this.$chapterText=o("span",{className:"chapter-text"}),this.$timecodeText=o("span",{className:"timecode-text"})])])]),this.$seekMarker=o("div",{className:"seek-marker"}),this.canvasResolution={scale:1,width:0,height:0},this.ctx=this.$canvas.getContext("2d"),null!==this.ctx?(this.setCanvasResolution(160,90),this.seekBar.append(this.$seekMarker,this.$container),window.addEventListener("blur",this.handlers.onWindowBlur),document.addEventListener("pointermove",this.handlers.onPointerMove),document.addEventListener("pointerdown",this.handlers.onPointerDown),document.addEventListener("pointerup",this.handlers.onPointerUp)):console.error("ThumbnailPreview: Could not acquire canvas context")}release(){window.removeEventListener("blur",this.handlers.onWindowBlur),document.removeEventListener("pointermove",this.handlers.onPointerMove),document.removeEventListener("pointerdown",this.handlers.onPointerDown),document.removeEventListener("pointerup",this.handlers.onPointerUp)}setFps(t){this.fps=t,this.refreshLastRendered()}setChapters(t){this.chapters=t,this.refreshLastRendered()}setImageTracks(t){this.imageTracks=t,this.refreshLastRendered()}setCanvasResolution(t,e){const s=window.devicePixelRatio;this.$canvas.width=s*t,this.$canvas.height=s*e,this.canvasResolution={scale:s,width:t,height:e},this.ctx.scale(s,s),this.refreshLastRendered()}ensureDisplaySize(t,e){const s=160/t*e;this.canvasResolution.height!==s&&(this.$display.style.height=`${s}px`,this.setCanvasResolution(160,s))}onWindowBlur(){this.setIsVisible(!1),this.changeEnd()}saneVideoDuration(){const t=this.player.getMediaElement()?.duration;return void 0!==t&&t>0?t:void 0}getThumbsTrack(){const t=this.player.getStats().estimatedBandwidth;let e;for(const s of this.imageTracks)s.bandwidth<.01*t&&(!e||s.bandwidth<e.bandwidth)&&(e=s);return e}mouseEventToPosition(t){const e=this.saneVideoDuration();if(void 0===e)return;if(null!==document.querySelector("input[type=button]:hover, button:hover"))return;const s=this.seekBar.getBoundingClientRect();if(!this.isChanging)if(this.showContainer){const{left:e,right:i,bottom:n}=s;if(!(e<=t.clientX&&t.clientX<=i&&t.clientY<=n))return;const{top:r}=this.$container.getBoundingClientRect();if(!(r<=t.clientY))return}else if(!(t.target instanceof Node&&this.seekBar.contains(t.target)))return;const n=e/s.width;let r=t.clientX-s.left,a=i(r*n,[0,e]);const o=this.chapters?.timeToChapter(a);let h=!1;if(o&&!this.isChanging){const t=(a-o.timecode)/n;-2<=t&&t<6&&(a=o.timecode,r=a/n,h=!0)}return{absolute:r,seconds:a,chapter:o,onChapterMarker:h}}async onPointerMove(t){const e=this.mouseEventToPosition(t);if(void 0===e)return this.setIsVisible(!1);this.isChanging&&0!=(1&t.buttons)&&this.interaction?.onChange?.(e),this.setIsVisible(!0,!1),this.renderSeekPosition(e);const s=this.getThumbsTrack();if(void 0===s)return;const i=await this.player.getThumbnails(s.id,e.seconds);if(null===i)return;const n=i.uris[0];void 0!==n&&(null===this.lastRendered||n!==this.lastRendered.uri?this.network.get(n).then((t=>{this.renderImageAndShow(n,i,t,e)})):this.renderImageAndShow(n,i,this.lastRendered.tilesetImage,e))}onPointerDown(t){if(0!=(1&t.buttons)){const e=this.mouseEventToPosition(t);void 0!==e&&(this.isChanging||(this.interaction?.onChangeStart?.(),document.body.classList.add("seek-or-scrub"),this.isChanging=!0),this.interaction?.onChange?.(e))}}onPointerUp(t){this.changeEnd(),void 0===this.mouseEventToPosition(t)&&this.setIsVisible(!1)}changeEnd(){this.isChanging&&(this.interaction?.onChangeEnd?.(),document.body.classList.remove("seek-or-scrub"),this.isChanging=!1)}renderThumbTimecode(t){const e=this.saneVideoDuration(),s=void 0===e||e>=3600,i=m(t.startTime+t.duration/2-1e-5,s,this.fps);this.ctx.font="8px sans-serif",this.ctx.textBaseline="top";const n=this.ctx.measureText(i),r=n.width,a=n.actualBoundingBoxDescent,o=this.canvasResolution.width-(r+2);this.ctx.fillStyle="black",this.ctx.fillRect(o-2,0,r+4,a+4),this.ctx.fillStyle="white",this.ctx.fillText(i,o,2)}renderImage(t,e,s,i=!1){if(i||null===this.lastRendered||e.startTime!==this.lastRendered.thumb.startTime){const{positionX:i,positionY:n,width:r,height:a}=e;this.ctx.drawImage(s,i,n,r,a,0,0,this.canvasResolution.width,this.canvasResolution.height),this.renderThumbTimecode(e),this.lastRendered={uri:t,thumb:e,tilesetImage:s}}}renderImageAndShow(t,e,s,i){0<=e.width&&e.width<=1&&0<=e.height&&e.height<=1&&(e.positionX*=s.width,e.width*=s.width,e.positionY*=s.height,e.height*=s.height),this.ensureDisplaySize(e.width,e.height),this.renderImage(t,e,s),this.setIsVisible(!0),this.positionContainer(i)}refreshLastRendered(){if(this.lastRendered){const{uri:t,thumb:e,tilesetImage:s}=this.lastRendered;this.renderImage(t,e,s,!0)}}positionContainer(t){const e=i(t.absolute-this.$container.offsetWidth/2,[0,this.seekBar.clientWidth-this.$container.offsetWidth]);this.$container.style.left=`${e}px`}renderSeekPosition(t){const e=this.saneVideoDuration();if(void 0===e)return void this.setIsVisible(!1);this.$seekMarker.style.left=`${t.absolute}px`,t.onChapterMarker?this.$info.classList.add("on-chapter-marker"):this.$info.classList.remove("on-chapter-marker");const s=t.chapter?.title??"";this.$chapterText.innerText=s,this.setElementVisible(this.$chapterText,""!==s),this.$timecodeText.innerText=m(t.seconds,e>=3600,this.fps),this.positionContainer(t)}get isVisible(){return this.showContainer}setIsVisible(t,e=t){this.showContainer=t,this.setElementVisible(this.$container,t),this.setElementVisible(this.$seekMarker,t),this.setElementVisible(this.$display,e)}setElementVisible(t,e){e?t.classList.add("shown"):t.classList.remove("shown")}}class g{constructor(t){if(this.player=t,this.manifest=t.getManifest(),this.groupKeys=[],this.groups=[],this.keyToGroup={},null!==this.manifest){for(const t of this.manifest.variants)this.addVariant(t);for(const t of this.manifest.imageStreams)t.width=1,t.height=1}else console.warn("Manifest not available")}static splitRepresentationId(t){const e=(t??"").split("#");return{id:e[0]??null,group:e[1]??"Standard"}}addVariant(t){const e=t.video;if(e){const s=g.splitRepresentationId(e.originalId).group,i=this.getGroupOrCreate(s);i.variants.push(t);for(const t of e.roles)i.roles.add(t)}}get numGroups(){return this.groupKeys.length}getGroupOrCreate(t){let e=this.keyToGroup[t];return e||(e=this.keyToGroup[t]={key:t,variants:[],roles:new Set},this.groupKeys.push(t),this.groups.push(e)),e}findActiveTrack(){return this.player.getVariantTracks().find((t=>t.active))}findImageTracks(){const t=this.findActiveGroup()?.key;return this.player.getImageTracks().filter((e=>g.splitRepresentationId(e.originalImageId).group===t))}findActiveGroup(){const t=this.findActiveTrack();if(t){const e=g.splitRepresentationId(t.originalVideoId).group;return this.keyToGroup[e]}}selectGroup(t){if(this.manifest){if(this.manifest.variants!==t.variants){const e=this.findActiveTrack();this.manifest.variants=t.variants,this.player.selectAudioLanguage(e?.language??"und")}}else console.warn("Cannot select group: Manifest not available")}trySelectGroup(t){return!!t&&(this.selectGroup(t),!0)}selectGroupByKey(t){return this.trySelectGroup(this.keyToGroup[t])}selectGroupByIndex(t){return this.trySelectGroup(this.groups[t])}selectGroupByRole(t){return this.trySelectGroup(this.groups.find((e=>e.roles.has(t))))}*[Symbol.iterator](){for(const t in this.keyToGroup)yield this.keyToGroup[t]}}class f extends d().ui.Element{static register(){d().ui.Controls.registerSeekBar({create:(t,e)=>new f(t,e)})}constructor(t,e){super(t,e),this.$container=o("div",{className:"sxnd-seek-bar"},[this.$range=o("div",{className:"range"})]),t.prepend(this.$container),this.sxnd={chapters:null,variantGroups:null,value:0,uiConfig:e.getConfig(),wasPlaying:!1,seekTimer:null,thumbnailPreview:null},this.sxnd.seekTimer=new(d().util.Timer)((()=>{null!==this.video&&(this.video.currentTime=this.getValue())})),null!==this.player&&(this.sxnd.thumbnailPreview=new v({seekBar:this.$container,player:this.player,network:new p,interaction:{onChangeStart:()=>{this.controls?.setSeeking(!0),null!==this.video&&(this.sxnd.wasPlaying=!this.video.paused,this.video.pause())},onChange:t=>{this.sxnd.value=t.seconds,this.update(),this.sxnd.seekTimer?.tickAfter(.125)},onChangeEnd:()=>{this.sxnd.seekTimer?.tickNow(),this.controls?.setSeeking(!1),this.sxnd.wasPlaying&&this.video?.play()}}})),this.eventManager&&(this.eventManager.listen(this.player,"loaded",(()=>{this.renderChapterMarkers()})),this.eventManager.listen(this.player,"variantchanged",(()=>{this.updatePreviewImageTracks()})),this.eventManager.listen(this.controls,"sxnd-variant-groups",(t=>{const e=t.detail;this.sxnd.variantGroups=e.variantGroups,this.updatePreviewImageTracks()})),this.eventManager.listen(this.controls,"sxnd-chapters",(t=>{const e=t.detail;this.sxnd.chapters=e.chapters,this.sxnd.thumbnailPreview?.setChapters(e.chapters)})),this.eventManager.listen(this.controls,"sxnd-fps",(t=>{const e=t.detail;this.sxnd.thumbnailPreview?.setFps(e.fps)})),this.controls?.dispatchEvent(new CustomEvent("sxnd-seek-bar",{detail:{seekBar:this}})))}release(){null!==this.sxnd.seekTimer&&(this.sxnd.seekTimer.stop(),this.sxnd.seekTimer=null),null!==this.sxnd.thumbnailPreview&&(this.sxnd.thumbnailPreview.release(),this.sxnd.thumbnailPreview=null),super.release()}isThumbnailPreviewOpen(){return this.sxnd.thumbnailPreview?.isVisible??!1}hideThumbnailPreview(){this.sxnd.thumbnailPreview?.setIsVisible(!1)}renderChapterMarkers(){if(null!==this.video&&null!==this.sxnd.chapters){if(this.video.duration>0)for(const t of this.sxnd.chapters){const e=t.timecode/this.video.duration;if(!(0<=e&&e<1))continue;const s=document.createElement("span");s.className="sxnd-chapter-marker",s.style.position="absolute",s.style.left=100*e+"%",this.$range.append(s)}}else console.log("FlatSeekBar: Missing video or chapters")}updatePreviewImageTracks(){if(null===this.sxnd.thumbnailPreview)return void console.warn("FlatSeekBar: Missing player or thumbnail preview");if(null===this.sxnd.variantGroups)return;const t=this.sxnd.variantGroups.findImageTracks();this.sxnd.thumbnailPreview.setImageTracks(t)}getValue(){return this.sxnd.value}isShowing(){return!0}setValue(t){this.controls?.isSeeking()||(this.sxnd.value=t)}makeColor(t,e){return`${t} ${100*e}%`}update(){if(null===this.video)return void console.warn("FlatSeekBar: Missing video");const t=this.video.duration;if(!(t>0))return;const e=this.sxnd.uiConfig.seekBarColors,s=this.getValue(),i=this.video.buffered.length,n=i?this.video.buffered.start(0):0,r=i?this.video.buffered.end(i-1):0,a={start:0,end:t},o=a.end-a.start;if(0==i)this.$range.style.background=e.base;else{const t=Math.max(n,a.start),i=Math.min(r,a.end),h=Math.min(Math.max(s,a.start),a.end),l=(t-a.start)/o||0,c=(i-a.start)/o||0,d=(h-a.start)/o||0,u=this.sxnd.uiConfig.showUnbufferedStart?e.base:e.played,p=["to right",this.makeColor(u,l),this.makeColor(e.played,l),this.makeColor(e.played,d),this.makeColor(e.buffered,d),this.makeColor(e.buffered,c),this.makeColor(e.base,c)];this.$range.style.background="linear-gradient("+p.join(",")+")"}}}d().ui.SettingsMenu;var y=function(t){if(this===window)return new y(t);this.obj=t||{},this.frameRate=this.obj.frameRate||24,this.video=document.getElementById(this.obj.id)||document.getElementsByTagName("video")[0]};y.prototype={get:function(){return Math.floor(this.video.currentTime.toFixed(5)*this.frameRate)},listen:function(t,e){var s=this;t?this.interval=setInterval((function(){if(!s.video.paused&&!s.video.ended){var e="SMPTE"===t?s.toSMPTE():"time"===t?s.toTime():s.get();return s.obj.callback&&s.obj.callback(e,t),e}}),e||1e3/s.frameRate/2):console.log("VideoFrame: Error - The listen method requires the format parameter.")},stopListen:function(){clearInterval(this.interval)},fps:{film:24,NTSC:29.97,NTSC_Film:23.98,NTSC_HD:59.94,PAL:25,PAL_HD:50,web:30,high:60}},y.prototype.toTime=function(t){var e="number"!=typeof t?this.video.currentTime:t,s=this.frameRate,i=new Date,n="hh:mm:ss"+("number"==typeof t?":ff":"");function r(t){return t<10?"0"+t:t}return i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(1e3*e),n.replace(/hh|mm|ss|ff/g,(function(t){switch(t){case"hh":return r(i.getHours()<13?i.getHours():i.getHours()-12);case"mm":return r(i.getMinutes());case"ss":return r(i.getSeconds());case"ff":return r(Math.floor(e%1*s))}}))},y.prototype.toSMPTE=function(t){if(!t)return this.toTime(this.video.currentTime);var e=Number(t),s=this.frameRate;function i(t){return t<10?"0"+t:t}var n=60*s,r=(e/(60*s*60)).toFixed(0),a=Number((e/n).toString().split(".")[0])%60,o=Number((e/s).toString().split(".")[0])%60;return i(r)+":"+i(a)+":"+i(o)+":"+i(e%s)},y.prototype.toSeconds=function(t){if(!t)return Math.floor(this.video.currentTime);var e=t.split(":");return 60*Number(e[0])*60+60*Number(e[1])+Number(e[2])},y.prototype.toMilliseconds=function(t){var e=Number(t?t.split(":")[3]:this.toSMPTE().split(":")[3]),s=1e3/this.frameRate*(isNaN(e)?0:e);return Math.floor(1e3*this.toSeconds(t)+s)},y.prototype.toFrames=function(t){var e=t?t.split(":"):this.toSMPTE().split(":"),s=this.frameRate,i=60*Number(e[0])*60*s,n=60*Number(e[1])*s,r=Number(e[2])*s,a=Number(e[3]);return Math.floor(i+n+r+a)},y.prototype.__seek=function(t,e){this.video.paused||this.video.pause();var s=Number(this.get());this.video.currentTime=("backward"===t?s-e:s+e)/this.frameRate+1e-5},y.prototype.seekForward=function(t,e){return t||(t=1),this.__seek("forward",Number(t)),!e||e()},y.prototype.seekBackward=function(t,e){return t||(t=1),this.__seek("backward",Number(t)),!e||e()},y.prototype.seekTo=function(t){var e,s,i=t||{},n=Object.keys(i)[0];if("SMPTE"==n||"time"==n)return s=i[n],e=this.toMilliseconds(s)/1e3+.001,void(this.video.currentTime=e);switch(n){case"frame":s=this.toSMPTE(i[n]),e=this.toMilliseconds(s)/1e3+.001;break;case"seconds":e=Number(i[n]);break;case"milliseconds":e=Number(i[n])/1e3+.001}isNaN(e)||(this.video.currentTime=e)};const k=y;class b extends d().ui.Element{static register(t){const e=t.mkid();return d().ui.Controls.registerElement(e,{create:(e,s)=>new b(e,s,t)}),e}constructor(t,e,s){super(t,e);const i=o("button",{className:"shaka-current-time"});if(t.appendChild(i),this.sxnd={env:s,currentTime:i},this.state={activeMode:0,totalSeconds:0,duration:0,vifa:null,fps:null,chapters:null},this.eventManager){this.eventManager.listen(i,"click",(()=>{this.render({activeMode:(this.state.activeMode+1)%3})}));const t=this.updateTime.bind(this);this.eventManager.listen(this.player,"loaded",t),this.eventManager.listen(this.controls,"timeandseekrangeupdated",t),this.eventManager.listen(this.controls,"sxnd-chapters",(t=>{const e=t.detail;this.render({chapters:e.chapters})})),this.eventManager.listen(this.controls,"sxnd-fps",(t=>{const e=t.detail;this.render({vifa:e.vifa,fps:e.fps})}))}}updateTime(){if(null===this.controls||null===this.video)return;let t=this.video.duration;t>=0||(t=0),this.render({duration:t,totalSeconds:i(this.controls.getDisplayTime(),[0,t])})}render(t){const{env:e,currentTime:s}=this.sxnd,i=Object.assign({},this.state,t);if(Object.keys(t).some((e=>t[e]!==this.state[e]))){const t={0:"current-time",1:"remaining-time",2:"current-frame"}[i.activeMode]??"current-time";s.textContent=this.getTimecodeText(t,i),s.title=e.t(`control.time.${t}.tooltip`)}this.state=i}getTimecodeText(t,{totalSeconds:e,duration:s,vifa:i,fps:n,chapters:r}){if(0===s)return"";{const a=s>=3600,o={get chapterTitle(){return r?.timeToChapter(e)?.title??"_"},get currentTime(){return m(e,a,n)},get totalTime(){return m(s,a,n)},get remainingTime(){return m(s-e,a,n)},get currentFrame(){return i?.get()??-1}};return this.sxnd.env.t(`control.time.${t}.text`,o)}}}class w extends d().ui.SettingsMenu{static register(t){const e=t.mkid();return d().ui.OverflowMenu.registerElement(e,{create:(e,s)=>new w(e,s,t)}),e}constructor(t,e,s){super(t,e,"switch_video"),this.sxnd={env:s,activeCheck:o("i",{className:"material-icons-round shaka-chosen-item"},["done"]),variantGroups:null},this.updateStrings(),this.updateVisibility(),this.menuButtons={},this.eventManager&&(this.eventManager.listen(this.controls,"sxnd-variant-groups",(t=>{const e=t.detail,s=this.sxnd.variantGroups=e.variantGroups;this.clearMenu(),this.updateVisibility();try{for(const t of s){const e=o("button",{$click:()=>{this.sxnd.variantGroups?.selectGroupByKey(t.key)}},[o("span",{},[t.key])]);this.menu.appendChild(e),this.menuButtons[t.key]=e}this.markActiveGroup()}catch(t){console.error(t)}})),this.eventManager.listen(this.player,"variantchanged",(()=>{this.markActiveGroup()})))}clearMenu(){for(const t of Object.values(this.menuButtons))t.remove();this.menuButtons={}}markActiveGroup(){const t=this.sxnd.variantGroups?.findActiveGroup();t&&(this.menuButtons[t.key]?.appendChild(this.sxnd.activeCheck),this.currentSelection.textContent=t.key)}updateVisibility(){(this.sxnd.variantGroups?.numGroups??0)>0?this.button.classList.remove("shaka-hidden"):this.button.classList.add("shaka-hidden")}updateStrings(){const t=this.sxnd.env.t("control.back"),e=this.sxnd.env.t("control.video-track.title");this.backButton.ariaLabel=t,this.button.ariaLabel=e,this.nameSpan.textContent=e,this.backSpan.textContent=e}}class x{static initSupport(){return d().polyfill.installAll(),d().Player.isBrowserSupported()?window.MediaSource&&window.MediaSource.isTypeSupported?["mpd","hls"]:["hls"]:[]}constructor(t){this.env=t,this.constants={prevChapterTolerance:5},this.mountPoint=null,this.container=o("div"),this.video=o("video",{id:this.env.mkid(),className:"sxnd-video"}),this.container.append(this.video),this.controlPanelButtons=[],this.overflowMenuButtons=[],this.player=new(d().Player)(this.video),this.ui=new(d().ui.Overlay)(this.player,this.container,this.video),this.controls=this.ui.getControls(),this.controlEventQueue=[],this.seekBar=null,this.vifa=null,this.fps=null,this.variantGroups=null,this.chapters=new l([]),this.handlers={onErrorEvent:this.onErrorEvent.bind(this),onTrackChange:this.onTrackChange.bind(this)},this.player.addEventListener("error",this.handlers.onErrorEvent),this.controls.addEventListener("error",this.handlers.onErrorEvent),this.player.addEventListener("adaptation",this.handlers.onTrackChange),this.player.addEventListener("variantchanged",this.handlers.onTrackChange),this.controls.addEventListener("sxnd-seek-bar",(t=>{const e=t.detail;this.seekBar=e.seekBar}))}setConstants(t){Object.assign(this.constants,t)}setPoster(t){this.video.poster=t}addControlElement(...t){this.controlPanelButtons.push(...t)}addOverflowButton(...t){this.overflowMenuButtons.push(...t)}mount(t){return null!==this.mountPoint?(console.warn("Player already mounted"),!1):(f.register(),this.ui.configure({addSeekBar:!0,controlPanelElements:["play_pause","chapters_menu",b.register(this.env),"spacer","volume","mute",...this.controlPanelButtons,"fullscreen","overflow_menu"],overflowMenuButtons:["language",w.register(this.env),"playback_rate","loop","quality","picture_in_picture","captions",...this.overflowMenuButtons],addBigPlayButton:!0,seekBarColors:{base:"rgba(255, 255, 255, 0.3)",buffered:"rgba(255, 255, 255, 0.54)",played:"rgb(255, 255, 255)",adBreaks:"rgb(255, 204, 0)"}}),t.replaceWith(this.container),this.mountPoint=t,!0)}get isMounted(){return null!==this.mountPoint}unmount(){null!==this.mountPoint&&(this.container.replaceWith(this.mountPoint),this.mountPoint=null)}async loadManifest(t,e=null){await this.player.load(t,e),this.variantGroups=new g(this.player),this.variantGroups.selectGroupByRole("main")||this.variantGroups.selectGroupByIndex(0),this.emitControlEvent("sxnd-variant-groups",{variantGroups:this.variantGroups}),this.updateFrameRate()}onTrackChange(){this.updateFrameRate()}updateFrameRate(){const t=this.variantGroups?.findActiveTrack()?.frameRate??null;null===t?(this.fps=null,this.vifa=null):t!==this.fps&&(this.fps=t,this.vifa=new k({id:this.video.id,frameRate:t})),this.emitControlEvent("sxnd-fps",{vifa:this.vifa,fps:this.fps})}isThumbnailPreviewOpen(){return this.seekBar?.isThumbnailPreviewOpen()??!1}hideThumbnailPreview(){this.seekBar?.hideThumbnailPreview()}anySettingsMenusAreOpen(){return this.controls.anySettingsMenusAreOpen()}hideSettingsMenus(){this.controls.hideSettingsMenus()}toggleFullScreen(){this.controls.toggleFullScreen()}setLocale(t){this.controls.getLocalization()?.changeLocale([t])}setChapters(t){this.chapters=t,this.emitControlEvent("sxnd-chapters",{chapters:t})}getCurrentChapter(){return this.timeToChapter(this.currentTime)}timeToChapter(t){return this.chapters.timeToChapter(t)}getVideo(){return this.video}get volume(){return this.video.volume}set volume(t){this.video.volume=i(t,[0,1])}get currentTime(){return this.video.currentTime}get displayTime(){return this.controls.getDisplayTime()}get muted(){return this.video.muted}set muted(t){this.video.muted=t}get paused(){return this.video.paused}play(){this.video.play()}pause(){this.video.pause()}getFps(){return this.fps}getVifa(){return this.vifa}seekTo(t){"number"==typeof t?this.video.currentTime=t:"number"==typeof t.timecode&&(this.video.currentTime=t.timecode)}skipSeconds(t){this.video.currentTime+=t}prevChapter(){const t=this.constants.prevChapterTolerance,e=this.chapters.timeToChapter(this.currentTime-t);this.seekTo(e??0)}nextChapter(){const t=this.getCurrentChapter();if(t){const e=this.chapters.advance(t,1);e&&this.seekTo(e)}}ensureTrickPlay(t){this.player.getPlaybackRate()!==t&&this.player.trickPlay(t)}cancelTrickPlay(){try{return this.player.cancelTrickPlay(),!0}catch(t){return!1}}emitControlEvent(t,e){this.controlEventQueue.push(new CustomEvent(t,{detail:e})),this.dispatchControlEvents()}dispatchControlEvents(){if(this.isMounted){for(const t of this.controlEventQueue)this.controls.dispatchEvent(t);this.controlEventQueue=[]}}onErrorEvent(t){if(t instanceof CustomEvent){const e=t.detail;console.error("Error code",e.code,"object",e)}}}const T=jQuery;var C=s.n(T),P=s(187),S=s.n(P);class M extends(S()){constructor(t){super(),this.state=t,this.pendingStateUpdates=[],this.renderTimeout=null,this.renderPromise=Promise.resolve()}setState(t={}){this.pendingStateUpdates.push(t),this.renderTimeout||(this.renderPromise=new Promise((t=>{this.renderTimeout=setTimeout((()=>{const e=this.squashStateUpdates(),s=Object.assign({},this.state,e);this.render(s),this.state=s,this.renderTimeout=null,this.renderPromise=Promise.resolve(),this.emit("updated",s),t()}))})))}update(){return this.renderPromise}squashStateUpdates(){const t=this.pendingStateUpdates.reduce(((t,e,s,i)=>Object.assign(t,e)),{});return this.pendingStateUpdates=[],t}render(t){}}class E extends M{constructor(t,e){super({show:!1,...e}),this.parent=t,this.isAnimating=!1,this.$main=o("div",{className:"sxnd-modal"},[this.$headline=o("div",{className:"headline-container"},[this.$title=o("h3"),this.$close=o("span",{className:"modal-close icon-close",$click:this.close.bind(this)})]),this.$body=o("div",{className:"body-container"})]),this.parent.append(this.$main),this.jqMain=C()(this.$main),this.resize()}resize(){this.$body.style.maxHeight=`calc(${this.parent.clientHeight}px - 11rem)`}get isOpen(){return this.state.show}open(t=!0){this.isAnimating||this.setState({show:t})}close(){this.open(!1)}toggle(){this.open(!this.state.show)}render(t){const{show:e}=t;if(e!=this.state.show){this.isAnimating=!0;const t=e?"show":"hide";this.jqMain[t]({duration:"fast",complete:()=>{this.isAnimating=!1}})}}}function $(t,e){const s=e.getLocation();return null!=t&&0!==t?s.searchParams.set("timecode",t.toString()):s.searchParams.delete("timecode"),s}class I extends E{constructor(t,e){super(t,{timecode:null,fps:0,startAtTimecode:!0}),this.env=e,this.$main.classList.add("bookmark-modal"),this.$title.innerText=this.env.t("modal.bookmark.title");const s=this.env.mkid();this.$body.append(o("div",{},[o("div",{className:"url-line"},[this.$urlInput=o("input",{type:"url",readOnly:!0,value:"https://sachsen.digital"}),o("a",{href:"javascript:void(0)",className:"copy-to-clipboard",title:this.env.t("modal.bookmark.copy-link"),$click:this.handleCopyToClipboard.bind(this)},[o("i",{className:"material-icons-round"},["content_copy"])])]),this.$startAt=o("div",{className:"start-at"},[this.$startAtCheck=o("input",{type:"checkbox",id:s,$change:this.handleChangeStartAtTimecode.bind(this)}),this.$startAtLabel=o("label",{htmlFor:s})])]))}async handleCopyToClipboard(){const t=this.generateUrl(this.state);this.$urlInput.focus(),navigator.clipboard?navigator.clipboard.writeText(t):document.execCommand("copy")}handleChangeStartAtTimecode(t){t.target instanceof HTMLInputElement&&this.setState({startAtTimecode:t.target.checked})}setTimecode(t){return this.setState({timecode:t}),this}setFps(t){return this.setState({fps:t}),this}generateUrl(t){return $(t.startAtTimecode?t.timecode:null,this.env).toString()}render(t){super.render(t);const{show:e,timecode:s,fps:i,startAtTimecode:n}=t;this.$urlInput.value=this.generateUrl(t),null===s||0===s?this.$startAt.classList.remove("shown"):(this.$startAtCheck.checked=n,this.$startAtLabel.innerText=this.env.t("modal.bookmark.start-at-current-time",{timecode:m(s,!0,i)}),this.$startAt.classList.add("shown")),e&&e!==this.state.show&&this.$urlInput.select()}}class L extends E{constructor(t,e,s){super(t,{}),this.env=e,this.config=s,this.createBodyDom()}createBodyDom(){const t=this.env;this.$body.classList.add("help-modal"),this.$title.innerText=t.t("modal.help.title");const e=function(t){const e={navigate:{},other:{}},s=t.slice();s.sort(((t,e)=>t.order-e.order));for(const t of s){let s=e[t.kind];s||(s=e[t.kind]={});let i=s[t.action];i||(i=s[t.action]=[]),i.push(t)}return e}(this.config.keybindings),s=Object.entries(e).flatMap((([e,s])=>{const i=[...Object.entries(s)];return 0===i.length?[]:[o("h3",{className:"subheader",innerText:t.t(`action.kind.${e}`)}),o("table",{className:"keybindings-table"},[o("tbody",{},[o("tr",{},[o("td",{className:"legend key"},[t.t("modal.help.key")]),o("td",{className:"legend action"},[t.t("modal.help.action")])]),...i.map((([t,e])=>o("tr",{},[o("td",{className:"key"},this.listKeybindingsDisj(e)),o("td",{className:"action"},[this.describeAction(t)])])))])])]}));this.$body.append(...s)}listKeybindingsDisj(t){const e=this.env;return t.flatMap(((t,s)=>{const i=this.getKeybindingText(t);return[s>0&&o("span",{className:"or-sep"},[` ${e.t("or")} `]),o("span",{className:"kb-text"},[i])]}))}getKeybindingText(t){const e=this.env;let s=t.mod?e.t(`key.mod.${t.mod}`)+" + "+e.t(`key.${t.key}.mod`):e.t(`key.${t.key}`);return t.repeat&&(s=e.t("key.repeat",{key:s})),s}describeAction(t){return this.env.t(`action.${t}`,this.config.constants)}}var B=s(8),N=s.n(B);class A{constructor(t){this.jpeg=t,this.exif=N().load(t)}static fromBinaryString(t){return new A(t)}toBinaryString(){const t=N().dump(this.exif);return N().insert(t,this.jpeg)}addMetadata(t){t.title&&(this.exif["0th"][N().ImageIFD.ImageDescription]=t.title),t.comment&&(this.exif.Exif[N().ExifIFD.UserComment]=t.comment)}getMetadata(){return{title:this.exif["0th"][N().ImageIFD.ImageDescription]??"",comment:this.exif.Exif[N().ExifIFD.UserComment]??""}}}const R=String.fromCharCode(137,80,78,71,13,10,26,10);class F{constructor(t,e){this.headerChunk=t,this.chunks=e}static createChunk(t){const e={};switch(t.type){case"raw":e.type=t.rawType,e.data=t.rawData;break;case"iTXt":e.type="iTXt",e.data=`${t.keyword.replace(/\0/g,"")}\0\0\0\0\0${t.text}`;break;case"IEND":e.type="IEND",e.data=""}return e.size=e.data.length,e.crc=function(t){for(var e=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],s=-1,i=0;i<t.length;i++)s=s>>>8^e[255&(s^t.charCodeAt(i))];return(-1^s)>>>0}(e.type+e.data),e}addChunk(t){const e=F.createChunk(t);if("iTXt"!==e.type)throw new Error(`Adding chunk type ${e.type} is not supported.`);this.chunks.unshift(e)}static fromBinaryString(t){if(!function(t){return t.substr(0,8)==R}(t.substr(0,8)))return;let e;t=t.substr(8);for(var s=[];""!=t;){var i={},n=D(t.substr(0,4));n<0&&(n=0);var r=t.substr(0,n+12);t=t.substr(n+12),i.size=n,i.type=r.substr(4,4),i.data=r.substr(8,n),i.crc=D(r.substr(8+n,4)),"IHDR"===i.type?e=i:"IEND"!==i.type&&s.push(i)}return void 0===e?void 0:new F(e,s)}toBinaryString(){var t=R;const e=e=>{var s="";s+=O(e.size,4),s+=e.type,s+=e.data,s+=O(e.crc,4),t+=s};e(this.headerChunk);for(const t of this.chunks)e(t);return e(F.createChunk({type:"IEND"})),t}addMetadata(t){for(const[e,s]of Object.entries(t)){if(!s)continue;const t={title:"Title",comment:"Comment"}[e];t&&this.addChunk({type:"iTXt",keyword:t,text:s})}}}function O(t,e){for(var s=[],i=e-1;i>=0;){var n=255&t;s[i--]=n,t>>=8}return s=s.map((function(t){return String.fromCharCode(t)})),s.join("")}function D(t){for(var e=0,s=0;s<t.length;s++)e=e<<8|255&t.charCodeAt(s);return e}const G=[{mimeType:"image/png",label:"PNG",parseBinaryString:t=>F.fromBinaryString(t)},{mimeType:"image/jpeg",label:"JPEG",parseBinaryString:t=>A.fromBinaryString(t)},{mimeType:"image/tiff",label:"TIFF",parseBinaryString:()=>{}}];class j extends E{constructor(t,e){const s=G.filter((t=>e.supportsCanvasExport(t.mimeType)));super(t,{metadata:null,showMetadata:!0,timecode:null,supportedImageFormats:s,selectedImageFormat:s[0]??null}),this.env=e,this.videoDomElement=null,this.$main.classList.add("screenshot-modal"),this.$title.innerText=e.t("modal.screenshot.title");const i=e.mkid(),n=e.mkid();this.$body.append(o("div",{className:"screenshot-config"},[o("span",{className:"show-metadata"},[o("input",{type:"checkbox",id:i,checked:this.state.showMetadata,$change:this.handleChangeShowMetadata.bind(this)}),o("label",{htmlFor:i},[e.t("modal.screenshot.show-metadata")])])," · ",o("span",{},[o("label",{},[e.t("modal.screenshot.file-format")]),":",o("span",{},this.state.supportedImageFormats.flatMap((t=>{const s=e.mkid();return[o("input",{id:s,name:n,type:"radio",checked:t.mimeType===this.state.selectedImageFormat?.mimeType,$change:()=>{this.setState({selectedImageFormat:t})}}),o("label",{htmlFor:s},[` ${t.label}`])]})))])," · ",o("a",{href:"#",$click:this.handleDownloadImage.bind(this)},[e.t("modal.screenshot.download-image")])]),this.$canvas=o("canvas"))}setVideo(t){return this.videoDomElement=t,this}setMetadata(t){return this.setState({metadata:t}),this}setTimecode(t){return this.setState({timecode:t}),this}handleChangeShowMetadata(t){t.target instanceof HTMLInputElement&&this.setState({showMetadata:t.target.checked})}async handleDownloadImage(t){t.preventDefault();const{metadata:e,timecode:s,selectedImageFormat:i}=this.state;null!==e&&null!==s&&null!==i?r(await this.makeImageBlob(this.$canvas,i,e,s),this.getFilename(e,s)):console.error("one of [metadata, timecode, selectedImageFormat] is null")}async makeImageBlob(t,e,s,i){const n=await function(t,e,s){return new Promise(((s,i)=>{t.toBlob((t=>{t?s(t):i()}),e,undefined)}))}(t,e.mimeType),r=await(a=n,new Promise(((t,e)=>{const s=new FileReader;s.onload=()=>{"string"==typeof s.result?t(s.result):e(null)},s.onerror=()=>{e(s.error)},s.readAsBinaryString(a)})));var a;const o=e.parseBinaryString(r);if(o){const t=$(i,this.env);o.addMetadata({title:s.metadata.title?.[0]??"",comment:`Screenshot taken on Sachsen.Digital.\n\n${t.toString()}`});const e=function(t){const e=new Uint8Array(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}(o.toBinaryString());return new Blob([e],{type:n.type})}return n}getFilename(t,e){return function(t){const e=t.replace(/[^a-zA-Z0-9()]+/g,"_");return e.length>0?e:"_"}(`Screenshot-${t.metadata.title?.[0]??"Unnamed"}-T${m(e,!0)}`)}getCaptions(t){return[{v:"bottom",h:"left",text:"https://sachsen.digital"},{v:"bottom",h:"right",text:t?(e=t,e.screenshotFields.map((t=>e.metadata[t]?.[0]??"")).join(" / ")):""}];var e}render(t){super.render(t);const{show:e,metadata:s,showMetadata:i}=t;if(null!==this.videoDomElement&&e&&(!this.state.show||i!==this.state.showMetadata)){const t={captions:i?this.getCaptions(s):[]};!function(t,e,s){const[i,n]=t instanceof HTMLCanvasElement?[t,t.getContext("2d")]:[t.canvas,t];if(null===n)return!1;i.width=e.videoWidth,i.height=e.videoHeight,n.drawImage(e,0,0,i.width,i.height);const r=i.height/1080,a=10*r;n.font=`${Math.floor(25*r)}px Arial`,n.fillStyle="#FFFFFF",n.shadowBlur=5,n.shadowColor="black";for(const t of s.captions){const e="left"===t.h?a:i.width-a,s="top"===t.v?a:i.height-a;n.textAlign=t.h,n.fillText(t.text,e,s)}}(this.$canvas,this.videoDomElement,t)}}}var U=s(15);class V{constructor(){this.idCnt=0,this.testCanvas=null,this.lang={twoLetterIsoCode:"en",phrasesInput:{},phrasesCompiled:{}}}getLocation(){return new URL(window.location.href)}supportsCanvasExport(t){return this.getTestCanvas().toDataURL(t).match(/data:(.*);/)?.[1]===t}mkid(){return"__autoid_"+ ++this.idCnt}setLang(t){this.lang={twoLetterIsoCode:t.twoLetterIsoCode,phrasesInput:t.phrases,phrasesCompiled:{}}}t(t,e={}){let s=this.lang.phrasesCompiled[t];if(void 0===s){const e=this.lang.phrasesInput[t];if(void 0===e)return console.error(`Warning: Translation key '${t}' not defined.`),t;s=this.lang.phrasesCompiled[t]=new U.ZP(e,this.lang.twoLetterIsoCode)}return s.format(e)}getTestCanvas(){return this.testCanvas||(this.testCanvas=document.createElement("canvas")),this.testCanvas}}const _=JSON.parse('[{"key":"Escape","action":"cancel","kind":"other","order":100},{"key":"F1","action":"modal.help.toggle","kind":"other","order":99},{"key":"b","scope":"player","action":"modal.bookmark.open","kind":"other","order":30},{"key":"s","scope":"player","action":"modal.screenshot.open","kind":"other","order":31},{"key":"f","repeat":false,"scope":"player","action":"fullscreen.toggle","kind":"other","order":20},{"key":" ","repeat":false,"scope":"player","action":"playback.toggle","kind":"other","order":0},{"key":"m","repeat":false,"scope":"player","action":"playback.volume.mute.toggle","kind":"other","order":12},{"key":"ArrowUp","scope":"player","action":"playback.volume.inc","kind":"other","order":10},{"key":"ArrowDown","scope":"player","action":"playback.volume.dec","kind":"other","order":11},{"key":"ArrowLeft","repeat":false,"scope":"player","action":"navigate.rewind","kind":"navigate","order":0},{"key":"ArrowRight","repeat":false,"scope":"player","action":"navigate.seek","kind":"navigate","order":1},{"key":"ArrowLeft","repeat":true,"scope":"player","action":"navigate.continuous-rewind","kind":"navigate","order":2},{"key":"ArrowRight","repeat":true,"scope":"player","action":"navigate.continuous-seek","kind":"navigate","order":3},{"mod":"CtrlMeta","key":"ArrowLeft","scope":"player","action":"navigate.chapter.prev","kind":"navigate","order":10},{"mod":"CtrlMeta","key":"ArrowRight","scope":"player","action":"navigate.chapter.next","kind":"navigate","order":11},{"mod":"Shift","key":"ArrowLeft","scope":"player","action":"navigate.frame.prev","kind":"navigate","order":20},{"mod":"Shift","key":"ArrowRight","scope":"player","action":"navigate.frame.next","kind":"navigate","order":21},{"key":",","scope":"player","action":"navigate.frame.prev","kind":"navigate","order":20},{"key":".","scope":"player","action":"navigate.frame.next","kind":"navigate","order":21}]');window.SxndPlayerApp=class{constructor(t,e,s){this.container=t,this.playerMount=o("div"),this.container.append(this.playerMount),this.videoInfo=e,this.lang=s,this.keybindings=_,this.constants={prevChapterTolerance:5,volumeStep:.05,seekStep:10,trickPlayFactor:4},this.handlers={onKeyDown:this.onKeyDown.bind(this),onKeyUp:this.onKeyUp.bind(this),onClickChapterLink:this.onClickChapterLink.bind(this)},this.env=new V,this.env.setLang(s),this.sxndPlayer=new x(this.env),this.manifestUri=null;for(const t of x.initSupport())if(e.url[t]){this.manifestUri=e.url[t];break}this.chapterLinks=[],this.modals=function(t){const e=Object.values(t),s={...t,hasOpen:()=>e.some((t=>t.isOpen)),closeNext:()=>{for(const t of e)if(t.isOpen){t.close();break}},closeAll:()=>{for(const t of e)t.close()},update:async()=>{await Promise.all(e.map((t=>t.update())))},resize:()=>{for(const t of e)t.resize()}},i=document.createElement("div");i.className="sxnd-modal-cover",i.addEventListener("click",(()=>{s.closeAll()})),document.body.append(i),window.addEventListener("resize",(()=>{s.resize()}));for(const t of e)t.on("updated",(()=>{s.hasOpen()?i.classList.add("shown"):i.classList.remove("shown")}));return s}({help:new L(this.container,this.env,{constants:this.constants,keybindings:this.keybindings}),bookmark:new I(this.container,this.env),screenshot:new j(this.container,this.env)}),this.actions={cancel:()=>{this.modals.hasOpen()?this.modals.closeNext():this.sxndPlayer.isThumbnailPreviewOpen()?this.sxndPlayer.hideThumbnailPreview():this.sxndPlayer.anySettingsMenusAreOpen()&&this.sxndPlayer.hideSettingsMenus()},"modal.help.open":()=>{this.sxndPlayer.hideThumbnailPreview(),this.modals.help.open()},"modal.help.toggle":()=>{this.sxndPlayer.hideThumbnailPreview(),this.modals.help.toggle()},"modal.bookmark.open":()=>{this.showBookmarkUrl()},"modal.screenshot.open":()=>{this.showScreenshot()},"fullscreen.toggle":()=>{this.sxndPlayer.hideThumbnailPreview(),this.sxndPlayer.toggleFullScreen()},"playback.toggle":()=>{this.sxndPlayer.paused?this.sxndPlayer.play():this.sxndPlayer.pause()},"playback.volume.mute.toggle":()=>{this.sxndPlayer.muted=!this.sxndPlayer.muted},"playback.volume.inc":()=>{this.sxndPlayer.volume=this.sxndPlayer.volume+this.constants.volumeStep},"playback.volume.dec":()=>{this.sxndPlayer.volume=this.sxndPlayer.volume-this.constants.volumeStep},"navigate.rewind":()=>{this.sxndPlayer.skipSeconds(-this.constants.seekStep)},"navigate.seek":()=>{this.sxndPlayer.skipSeconds(+this.constants.seekStep)},"navigate.continuous-rewind":()=>{this.sxndPlayer.ensureTrickPlay(-this.constants.trickPlayFactor)},"navigate.continuous-seek":()=>{this.sxndPlayer.ensureTrickPlay(this.constants.trickPlayFactor)},"navigate.chapter.prev":()=>{this.sxndPlayer.prevChapter()},"navigate.chapter.next":()=>{this.sxndPlayer.nextChapter()},"navigate.frame.prev":()=>{this.sxndPlayer.getVifa()?.seekBackward(1)},"navigate.frame.next":()=>{this.sxndPlayer.getVifa()?.seekForward(1)}},this.load()}failWithError(t){this.sxndPlayer.unmount();const e=o("div",{className:"sxnd-player-fatal-error"},[this.env.t(t)]);this.container.innerHTML="",this.container.append(e)}getStartTime(t){const e=this.env.getLocation().searchParams.get("timecode");return null!==e?e?parseFloat(e):void 0:void 0!==this.videoInfo.pageNo?t.at(this.videoInfo.pageNo-1)?.timecode:void 0}async load(){if(null===this.manifestUri)return void this.failWithError("error.playback-not-supported");document.querySelectorAll("a[data-timecode]").forEach((t=>{const e=Number(t.getAttribute("data-timecode"));if(Number.isFinite(e)){const s=t;s.sxndTimecode=e,s.addEventListener("click",this.handlers.onClickChapterLink),this.chapterLinks.push(s)}}));const t=this.videoInfo.chapters.map((t=>({...t,timecode:parseInt(t.timecode,10)}))),e=new l(t),s=this.getStartTime(e);this.sxndPlayer.addControlElement(u.register(this.env,{material_icon:"photo_camera",title:this.env.t("control.screenshot.tooltip"),onClick:this.actions["modal.screenshot.open"]}),u.register(this.env,{material_icon:"bookmark_border",title:this.env.t("control.bookmark.tooltip"),onClick:this.actions["modal.bookmark.open"]}),u.register(this.env,{material_icon:"help_outline",title:this.env.t("control.help.tooltip"),onClick:this.actions["modal.help.open"]})),this.sxndPlayer.setConstants(this.constants),this.sxndPlayer.setLocale(this.lang.twoLetterIsoCode),this.sxndPlayer.setPoster(this.videoInfo.url.poster),this.sxndPlayer.setChapters(e),this.sxndPlayer.mount(this.playerMount);try{await this.sxndPlayer.loadManifest(this.manifestUri,s)}catch(t){this.failWithError("error.load-failed")}document.addEventListener("keydown",this.handlers.onKeyDown,{capture:!0}),document.addEventListener("keyup",this.handlers.onKeyUp,{capture:!0})}getKeyboardScope(){return this.modals.hasOpen()?"modal":"player"}onKeyDown(t){let e=!0;const s=function(t){let e=h.None;return(t.ctrlKey||t.metaKey)&&(e|=h.CtrlMeta),t.shiftKey&&(e|=h.Shift),t.altKey&&(e|=h.Alt),e}(t),i=this.getKeyboardScope(),n=this.keybindings.find((e=>!("function"!=typeof this.actions[e.action]||e.key!==t.key||null!=e.repeat&&e.repeat!==t.repeat||null!=e.scope&&e.scope!==i||h[e.mod??"None"]!==s)));n&&(t.preventDefault(),this.actions[n.action](),!0===n.propagate&&(e=!1)),e&&t.stopImmediatePropagation()}onKeyUp(t){t.stopImmediatePropagation(),this.sxndPlayer.cancelTrickPlay()}onClickChapterLink(t){t.preventDefault();const e=t.currentTarget;this.sxndPlayer.play(),this.sxndPlayer.seekTo(e.sxndTimecode)}showBookmarkUrl(){this.sxndPlayer.pause(),this.sxndPlayer.hideThumbnailPreview(),this.modals.bookmark.setTimecode(this.sxndPlayer.displayTime).setFps(this.sxndPlayer.getFps()??0).open()}showScreenshot(){this.sxndPlayer.pause(),this.sxndPlayer.hideThumbnailPreview(),this.modals.screenshot.setVideo(this.sxndPlayer.getVideo()).setMetadata(this.videoInfo.metadata).setTimecode(this.sxndPlayer.displayTime).open()}}}},s={};function i(t){var n=s[t];if(void 0!==n)return n.exports;var r=s[t]={exports:{}};return e[t](r,r.exports,i),r.exports}i.m=e,t=[],i.O=(e,s,n,r)=>{if(!s){var a=1/0;for(c=0;c<t.length;c++){for(var[s,n,r]=t[c],o=!0,h=0;h<s.length;h++)(!1&r||a>=r)&&Object.keys(i.O).every((t=>i.O[t](s[h])))?s.splice(h--,1):(o=!1,r<a&&(a=r));if(o){t.splice(c--,1);var l=n();void 0!==l&&(e=l)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[s,n,r]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={825:0};i.O.j=e=>0===t[e];var e=(e,s)=>{var n,r,[a,o,h]=s,l=0;if(a.some((e=>0!==t[e]))){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(h)var c=h(i)}for(e&&e(s);l<a.length;l++)r=a[l],i.o(t,r)&&t[r]&&t[r][0](),t[a[l]]=0;return i.O(c)},s=self.webpackChunkslub_web_sachsendigital=self.webpackChunkslub_web_sachsendigital||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var n=i.O(void 0,[276],(()=>i(330)));n=i.O(n)})();
//# sourceMappingURL=SxndPlayerApp.js.map